<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>GCS Level Test - Faculty of Nursing</title>
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        /* Add this to your existing CSS styles */
        
        .source-path-info {
          margin-top: 10px;
          padding: 8px 12px;
          background-color: #f5f5f5;
          border-radius: 6px;
          font-size: 14px;
          color: #666;
          border-left: 3px solid #FF6B00;
          display: flex;
          align-items: center;
          gap: 5px;
        }
        
        .source-path-info i {
          color: #FF6B00;
        }
        
        /* Optional: add hover effect to make it more interactive */
        .source-path-info:hover {
          background-color: #fff9f0;
          color: #333;
        }
        
        body {
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            width: 100%;
            height: 550px;
            position: relative;
            background: #D84315;
            color: white;
            overflow: hidden;
            border-bottom: 4px solid #FF6B00;
        }
        
        /* ปรับค่า filter ของวิดีโอเพื่อเพิ่มความสดใส */
        .header-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.2) contrast(1.1);
        }

        /* MODIFIED: Removed background color from header-overlay to make video more vibrant */
        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0); /* Changed from 0.2 to 0 */
            z-index: 1;
        }
        
        .header-content {
            position: absolute;
            z-index: 2;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .level-subtitle {
            font-size: 24px;
            color: #FFD700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .content-container {
            background-color: white;
            padding: 40px 25px;
            min-height: 500px;
            display: flex;
            flex-direction: row;
        }
        
        .media-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 20px;
            width: 60%;
        }
        
        .quiz-container {
            width: 40%;
            padding-left: 30px;
        }
        .answer-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1100;
            max-width: 90%;
            width: 500px;
            display: none;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1050;
            display: none;
        }
        
        .answer-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #D84315;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .answer-modal-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .answer-modal-category {
            font-weight: bold;
            width: 150px;
            color: #555;
        }
        
        .answer-modal-value {
            font-weight: bold;
            color: #FF6B00;
        }
        
        .answer-status {
            font-size: 22px;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .answer-status.correct {
            color: #4CAF50;
        }
        
        .answer-status.incorrect {
            color: #F44336;
        }
        
        .media-item {
            background-color: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .media-header {
            padding: 15px 20px;
            background-color: #FF6B00;
            color: white;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .media-content {
            padding: 20px;
        }
        
        .media-video {
            width: 100%;
            border-radius: 5px;
            max-height: 500px;
            object-fit: contain;
        }
        
        .media-image {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 5px;
        }
        
        .home-button {
            position: absolute; /* Positioned within the header */
            top: 20px;
            left: 20px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.9); /* White with slight transparency */
            color: #FF6B00; /* Orange icon color for contrast */
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Softer shadow */
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6); /* Subtle border */
        }
        
        .home-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
            background-color: white; /* Fully white on hover */
            color: #FFD700; /* Gold color on hover */
            border-color: white;
        }
        
        .home-button i {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .home-button:hover i {
            transform: scale(1.2);
        }
        
        .home-button::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
            transform: scale(0);
            transition: 0.5s;
        }
        
        .home-button:hover::before {
            transform: scale(2);
            opacity: 0;
        }
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
        
            50% {
                transform: translateY(-10px);
            }
        
            100% {
                transform: translateY(0px);
            }
        }
        
        .home-button-text {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            left: 80px;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.3s ease;
        }
        
        .home-button:hover .home-button-text {
            opacity: 1;
            transform: translateX(0);
        }
        
        .back-button {
            position: absolute; /* Positioned within the header */
            top: 20px;
            right: 20px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.9); /* White with slight transparency */
            color: #FF6B00; /* Orange icon color for contrast */
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Softer shadow */
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6); /* Subtle border */
        }
        
        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
            background-color: white;
            color: #FFD700;
            border-color: white;
        }
        
        .back-button i {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .back-button::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.2) 0%, rgba(255,255,255,0) 70%); /* Subtle gold glow */
            border-radius: 50%;
            transform: scale(0);
            transition: 0.5s;
        }
        
        .back-button:hover::before {
            transform: scale(2);
            opacity: 0;
        }
        
        
        .back-button:hover i {
            transform: scale(1.2);
        
        }
        
                @keyframes float {
                    0% {
                        transform: translateY(0px);
                    }
        
                    50% {
                        transform: translateY(-10px);
                    }
        
                    100% {
                        transform: translateY(0px);
                    }
                }
        
        .back-button-text {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            right: 80px;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
        }
        
        .back-button:hover .back-button-text {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* UPDATED: Increased button size and padding */
        .next-button {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B00, #FF9100);
            color: white;
            padding: 18px 32px;  /* Increased from 14px 28px */
            border-radius: 30px;
            font-weight: bold;
            font-size: 20px;  /* Increased from 18px */
            margin-top: 25px;  /* Increased from 20px */
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 6px 12px rgba(255, 107, 0, 0.3);
            text-align: center;
            width: 100%;
            border: none;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;  /* Added for better readability */
        }
        
        .next-button:hover {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #333;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(255, 170, 0, 0.4);
        }
        
        .next-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }
        
        .next-button:hover:before {
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
        
        .next-button i {
            margin-left: 10px;  /* Increased from 8px */
            font-size: 22px;  /* Added font size for icon */
        }
        
        .next-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        
        .footer {
            padding: 20px;
            text-align: center;
            background-color: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
        }
        
        .university-footer-logo {
            height: 50px;
            width: auto;
            border-radius: 4px;
            margin-right: 15px;
        }
        
        .footer-text {
            font-weight: bold;
            font-size: 16px;
        }
        
        .quiz-section {
            margin-bottom: 30px;
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
            background-color: #D84315;
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        /* UPDATED: Increased option size */
        .quiz-option {
            padding: 18px 22px;  /* Increased from 16px 20px */
            font-size: 18px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-option:hover {
            transform: translateX(8px);
            background-color: rgba(255, 107, 0, 0.1);
        }
        
        .quiz-option.selected {
            background-color: rgba(255, 107, 0, 0.2);
            border-left: 4px solid #FF6B00;
        }
        
        .quiz-option.correct {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
        }
        
        .quiz-option.incorrect {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #F44336;
        }
        
        .quiz-option.inactive {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .quiz-feedback.correct {
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            color: #2E7D32;
        }
        
        .quiz-feedback.incorrect {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid #F44336;
            color: #C62828;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #F44336;
        }
        
        .progress-container {
            margin-bottom: 30px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgb(246, 246, 246);
        }
        
        .progress-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #FF6B00;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }
        
.result-container {
    text-align: center;
    padding: 30px;
    background-color: #f8f8f8;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    display: none; /* เปลี่ยนจาก none เป็น block เมื่อแสดงผล */
    
    /* วิธีจัดกลางที่แน่นอน */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    
    width: 80%;
    max-width: 600px;
    z-index: 1000; /* ให้แสดงข้างบนสุด */
}

@media (max-width: 768px) {
    .result-container {
        width: 95%;
        padding: 20px;
        max-width: none;
    }
}

@media (max-width: 480px) {
    .result-container {
        width: 98%;
        padding: 15px;
        top: 45%; /* ปรับตำแหน่งบนมือถือ */
    }
}
        
        .result-title {
            font-size: 28px;
            color: #D84315;
            margin-bottom: 20px;
        }
        
        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #FF6B00;
            margin-bottom: 20px;
        }
        
        .result-message {
            font-size: 18px;
            margin-bottom: 30px;
            color: #333;
        }
        
        .result-button {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B00, #FF9100);
            color: white;
            padding: 18px 32px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 6px 15px rgba(255, 107, 0, 0.4);
            margin: 15px;
            border: none;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            min-width: 220px;
        }
        
        .result-button:hover {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #333;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 170, 0, 0.5);
        }
        
        .result-button:active {
            transform: translateY(2px);
            box-shadow: 0 4px 10px rgba(255, 107, 0, 0.3);
        }
        
        .result-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }
        
        .result-button:hover:before {
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
        
        /* เพิ่มไอคอนใน HTML หรือใช้ CSS pseudo-elements */
        .result-button.restart:before {
            font-family: "Font Awesome 5 Free"; /* ต้องมีการเรียกใช้ Font Awesome */
            content: "\f2f1";
            margin-right: 10px;
        }
        
        .result-button.home:before {
            font-family: "Font Awesome 5 Free";
            content: "\f015";
            margin-right: 10px;
        }
        
        /* ปรับแต่ง container ที่บรรจุปุ่ม */
        .result-buttons-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 30px;
        }
        /* Responsive design สำหรับปุ่ม */
@media (max-width: 768px) {
    .result-button {
        padding: 20px 36px;
        font-size: 22px;
        margin: 12px;
        min-width: 240px;
    }
}

@media (max-width: 480px) {
    .result-button {
        display: block;
        width: 100%;
        max-width: 280px;
        margin: 15px auto;
    }
    
    .result-buttons-container {
        flex-direction: column;
        align-items: center;
    }
}
        
        /* Answer section styling - UPDATED with larger dimensions */
        .answer-section {
            margin: 25px 0;  /* Increased from 20px */
            padding: 25px;  /* Increased from 20px */
            background-color: #fff9f0;
            border-radius: 12px;  /* Increased from 10px */
            border-left: 6px solid #FF6B00;  /* Increased from 5px */
            box-shadow: 0 4px 12px rgb(255, 255, 255);  /* Enhanced shadow */
            display: none;
            width: 100%;
            max-width: 650px;  /* Increased from 600px */
            margin-left: auto;
            margin-right: auto;
        }
        
        .answer-title {
            font-size: 24px;  /* Increased from 22px */
            font-weight: bold;
            margin-bottom: 18px;  /* Increased from 15px */
            color: #D84315;
            text-align: center;
        }
        
        .answer-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;  /* Increased from 10px */
            padding-bottom: 12px;  /* Increased from 10px */
            border-bottom: 1px solid #eee;
        }
        
        .answer-item:last-child {
            border-bottom: none;
        }
        
        .answer-category {
            font-weight: bold;
            width: 130px;  /* Increased from 120px */
            color: #555;
            font-size: 16px;  /* Added font size */
        }
        
        .answer-value {
            font-weight: bold;
            color: #FF6B00;
            font-size: 16px;  /* Added font size */
        }
        
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .content-container {
                flex-direction: column;
            }
        
            .media-container,
            .answer-section {
                width: 100%;
            }
        
.quiz-container {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    min-height: 400px;
}
        
            .answer-section {
                margin-top: 0;
                margin-bottom: 20px;
            }
            
            /* UPDATED: Make next button even larger on tablets */
            .next-button {
                padding: 20px 35px;
                font-size: 22px;
            }
        }
        
        @media (max-width: 767px) {
            .header {
                height: 250px;
            }
        
            .header h1 {
                font-size: 28px;
            }
        
            .level-subtitle {
                font-size: 20px;
            }
        
            .home-button,
            .back-button {
                width: 50px;
                height: 50px;
            }
        
            .home-button i,
            .back-button i {
                font-size: 20px;
            }
        
            .media-header {
                font-size: 16px;
                padding: 12px 15px;
            }
        
            .content-container {
                padding: 25px 15px;
            }
        
            /* UPDATED: Increased size on mobile */
            .next-button {
                padding: 18px 25px;
                font-size: 18px;
                margin-bottom: 10px;
            }
        
            .quiz-title {
                font-size: 28px;
                padding: 15px 20px;
            }
            
            /* UPDATED: Increased answer section size on mobile */
            .answer-section {
                padding: 20px;
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                height: 200px;
            }
        
            .header h1 {
                font-size: 24px;
            }
        
            .level-subtitle {
                font-size: 18px;
            }
        
            .home-button,
            .back-button {
                width: 40px;
                height: 40px;
                top: 15px;
            }
        
            .home-button i,
            .back-button i {
                font-size: 18px;
            }
        
            .home-button {
                left: 15px;
            }
        
            .back-button {
                right: 15px;
            }
        
            .media-header {
                font-size: 14px;
                padding: 10px;
            }
        
            .media-content {
                padding: 15px;
            }
        
            .footer-text {
                font-size: 14px;
            }
        
            .quiz-title {
                font-size: 22px;
                padding: 12px 15px;
            }
        
            /* UPDATED: Still maintain larger size on small screens */
            .quiz-option {
                padding: 15px 18px;
                font-size: 16px;
                margin-bottom: 10px;
            }
            
            /* UPDATED: Ensure next button remains prominent on small screens */
            .next-button {
                padding: 16px 22px;
                font-size: 18px;
                margin-top: 15px;
            }
        }

        .progress-stats {
    display: flex;
    justify-content: space-between;
    margin-top: 5px;
    font-size: 14px;
    color: #666;
}

/* สไตล์เมื่อเวลาใกล้หมด */
#timer-display {
    font-weight: bold;
    color: #333;
}

#timer-display.warning {
    color: #FF6B00;
}

#timer-display.danger {
    color: #F44336;
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.video-warning {
  background-color: #FFF3E0;
  color: #E65100;
  padding: 8px 12px;
  border-radius: 4px;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  border-left: 3px solid #FF6B00;
}

.video-warning i {
  color: #FF6B00;
}

.custom-alert-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 2000;
  display: flex;
  justify-content: center;
  align-items: center;
}

.custom-alert {
  background-color: white;
  border-radius: 10px;
  width: 90%;
  max-width: 400px;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
  animation: alertFadeIn 0.3s ease;
}

@keyframes alertFadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.custom-alert-header {
  padding: 15px 20px;
  background-color: #FF6B00;
  color: white;
  display: flex;
  align-items: center;
  gap: 10px;
}

.custom-alert-header h3 {
  margin: 0;
  font-size: 18px;
  flex-grow: 1;
}

.custom-alert-close {
  cursor: pointer;
  font-size: 18px;
  transition: color 0.2s;
}

.custom-alert-close:hover {
  color: #FFD700;
}

.custom-alert-body {
  padding: 20px;
  font-size: 16px;
  color: #333;
}

.custom-alert-footer {
  padding: 15px;
  text-align: right;
  border-top: 1px solid #eee;
}

.custom-alert-button {
  background-color: #FF6B00;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: background-color 0.2s;
}

.custom-alert-button:hover {
  background-color: #FF9100;
}

.video-container {
  position: relative;
  width: 100%;
  height: 100%;
}

.video-play-button {
  position: absolute;
  bottom: 20px;
  right: 20px;
  width: 80px;
  height: 80px;
  background-color: rgba(21, 248, 104, 0.8);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s ease;
}

.video-play-button i {
  color: white;
  font-size: 24px;
}

.video-play-button:hover {
  background-color: rgb(134, 255, 123);
  transform: scale(1.1);
}

/* ซ่อนปุ่มเล่นเมื่อวิดีโอเล่น */
.video-container video[playing] + .video-play-button {
  display: none;
}

.video-stop-button {
  position: absolute;
  bottom: 20px;
  right: 20px;
  width: 80px;
  height: 80px;
  background-color: rgba(21, 248, 104, 0.8);
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  z-index: 10;
  transition: all 0.3s ease;
}

.video-stop-button i {
  color: white;
  font-size: 24px;
}

.video-stop-button:hover {
  background-color: rgb(134, 255, 123);
  transform: scale(1.1);
}

.result-button.next-level {
    background: linear-gradient(135deg, #4CAF50, #2E7D32);
    color: white;
}

.result-button.next-level:hover {
    background: linear-gradient(135deg, #81C784, #4CAF50);
    color: white;
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 10px 20px rgba(76, 175, 80, 0.5);
}

.result-button.next-level i {
    margin-right: 10px;
}

    </style>
    </head>

    <body>
        <div class="container">
            <!-- Header Section -->
            <div class="header">
                <!-- Home Button -->
                <div class="home-button" onclick="goToHome()">
                    <i class="fas fa-home"></i>
                    <span class="home-button-text">หน้าหลัก</span>
                </div>

                <!-- Back Button -->
                <div class="back-button" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                    <span class="back-button-text">กลับ</span>
                </div>
                <div class="media-content">
  <div class="video-warning">
    <i class="fas fa-exclamation-circle"></i> สามารถดูวิดีโอนี้ได้สูงสุด 2 ครั้งเท่านั้น
  </div>
  <video class="media-video" controls>
    <source src="assets/test_v/${scenarioId}/${scenarioId}.mp4" type="video/mp4">
  </video>
</div>
                <video class="header-video" autoplay muted loop playsinline>
                    <source src type="video/mp4" id="header-video-source">
                    Your browser does not support the video tag.
                </video>
                <div class="header-overlay"></div>
                <div class="header-content">

                </div>
            </div>

            

            <!-- Content Container -->
            <div class="content-container">
                <div class="media-container" id="media-container">
                    <!-- Media items will be dynamically added here -->

                </div>
                <div class="modal-overlay" id="modal-overlay"></div>
                <div class="answer-modal" id="answer-modal">
                    <i class="fas fa-times modal-close" id="modal-close"
                        onclick="hideAnswerSection()"></i>
                    <div class="answer-modal-title">เฉลยคำตอบ</div>
                    <div class="answer-status" id="answer-status">ถูกต้อง!</div>
                    <div class="answer-modal-item">
                        <div class="answer-modal-category">Eye Opening:</div>
                        <div class="answer-modal-value"
                            id="modal-answer-eye"></div>
                    </div>
                    <div class="answer-modal-item">
                        <div class="answer-modal-category">Verbal
                            Response:</div>
                        <div class="answer-modal-value"
                            id="modal-answer-verbal"></div>
                    </div>
                    <div class="answer-modal-item">
                        <div class="answer-modal-category">Motor Response:</div>
                        <div class="answer-modal-value"
                            id="modal-answer-motor"></div>
                    </div>
                </div>
                <div class="custom-alert-overlay" id="custom-alert-overlay" style="display: none;">
  <div class="custom-alert">
    <div class="custom-alert-header">
      <i class="fas fa-exclamation-triangle" id="custom-alert-icon"></i>
      <h3 id="custom-alert-title">แจ้งเตือน</h3>
      <i class="fas fa-times custom-alert-close" onclick="hideCustomAlert()"></i>
    </div>
    <div class="custom-alert-body" id="custom-alert-message"></div>
    <div class="custom-alert-footer">
      <button class="custom-alert-button" onclick="hideCustomAlert()">ตกลง</button>
    </div>
  </div>
</div>
                <div class="quiz-container" id="quiz-container">
                    <!-- Progress tracker -->
                    <div class="progress-container">
                        <div class="progress-title">แบบทดสอบที่ <span
                                id="current-scenario">1</span>/5</div>
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="progress-bar"
                                style="width: 20%;"></div>
                        </div>
                        <div class="progress-stats">
                            <div>คะแนน: <span
                                    id="current-score">0</span>/5</div>
                            <div>เวลาที่เหลือ: <span
                                    id="timer-display">5:00</span></div>
                        </div>
                    </div>

                    <!-- Quiz sections will be dynamically added here -->
                    <div id="quiz-sections-container"></div>

                    <!-- Next button -->
                    <button class="next-button" id="next-button" disabled>
                        ถัดไป <i class="fas fa-arrow-right"></i>
                    </button>

                    <!-- Results container (hidden initially) -->
                    <div class="result-container" id="result-container">
                        <div class="result-title">ผลการทดสอบ</div>
                        <div class="result-score"><span
                                id="final-score">0</span>/5</div>
                        <div class="result-message"
                            id="result-message">คุณทำได้ดีมาก!</div>
                    </div>
                </div>

            </div>

            <!-- Answer Section (hidden initially) -->

            <!-- Footer -->
            <div class="footer">
                <img src="assets/images/university_logo.jpg"
                    alt="University Logo" class="university-footer-logo">
                <span class="footer-text">GCS SSKRU Faculty of nursing</span>
            </div>
        </div>

        <script>

            // ตัวแปรเพิ่มเติมสำหรับระบบใหม่
    let videoPlayCount = 0;
    let timeLeft = 300; // 5 นาที (300 วินาที)
    let timerInterval;
    let currentVideoElement;

    function showCustomAlert(message, title = 'แจ้งเตือน') {
  const overlay = document.getElementById('custom-alert-overlay');
  const alertTitle = document.getElementById('custom-alert-title');
  const alertMessage = document.getElementById('custom-alert-message');
  const alertIcon = document.getElementById('custom-alert-icon');
  
  alertTitle.textContent = title;
  alertMessage.textContent = message;
  
  // เปลี่ยนสีและไอคอนตามประเภทการแจ้งเตือน
  if (title.includes('หมดเวลา')) {
    alertIcon.className = 'fas fa-clock';
    document.querySelector('.custom-alert-header').style.backgroundColor = '#F44336';
    document.querySelector('.custom-alert-button').style.backgroundColor = '#F44336';
  } else if (title.includes('สำเร็จ')) {
    alertIcon.className = 'fas fa-check-circle';
    document.querySelector('.custom-alert-header').style.backgroundColor = '#4CAF50';
    document.querySelector('.custom-alert-button').style.backgroundColor = '#4CAF50';
  } else {
    alertIcon.className = 'fas fa-exclamation-triangle';
    document.querySelector('.custom-alert-header').style.backgroundColor = '#FF6B00';
    document.querySelector('.custom-alert-button').style.backgroundColor = '#FF6B00';
  }
  
  overlay.style.display = 'flex';
}

function hideCustomAlert() {
  document.getElementById('custom-alert-overlay').style.display = 'none';
}

        // ฟังก์ชันสำหรับเริ่มจับเวลา
    function startTimer() {
        clearInterval(timerInterval); // เคลียร์ timer เดิม (ถ้ามี)
        timeLeft = 300; // รีเซ็ตเวลาเป็น 5 นาที
        updateTimerDisplay();
        
        timerInterval = setInterval(() => {
            timeLeft--;
            updateTimerDisplay();
            
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                handleTimeOut();
            }
        }, 1000);
    }

    // ฟังก์ชันแสดงเวลาที่เหลือ
function updateTimerDisplay() {
    const minutes = Math.floor(timeLeft / 60);
    const seconds = timeLeft % 60;
    const timerDisplay = document.getElementById('timer-display');
    
    timerDisplay.textContent = `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    
    // เปลี่ยนสีตามเวลาที่เหลือ
    timerDisplay.className = '';
    if (timeLeft <= 60) {
        timerDisplay.classList.add('danger');
    } else if (timeLeft <= 120) {
        timerDisplay.classList.add('warning');
    }
}

function handleTimeOut() {
  showCustomAlert('เวลาในการทำข้อสอบข้อนี้หมดแล้ว! ระบบจะบันทึกคำตอบปัจจุบันและไปข้อต่อไป', 'หมดเวลา');
  handleAnswerClick();
}

function setupVideoTracking(videoElement) {
  currentVideoElement = videoElement;
  videoPlayCount = 0;
  
  // ปิดการใช้งาน controls มาตรฐาน
  videoElement.controls = false;
  
  // สร้าง container สำหรับปุ่มเล่น
  const videoContainer = document.createElement('div');
  videoContainer.className = 'video-container';
  videoContainer.style.position = 'relative';
  videoContainer.style.width = '100%';
  videoContainer.style.height = '100%';
  
  // ย้าย video element เข้าไปใน container
  videoElement.parentNode.insertBefore(videoContainer, videoElement);
  videoContainer.appendChild(videoElement);
  
  // สร้างปุ่มเล่น
  const playButton = document.createElement('div');
  playButton.className = 'video-play-button';
  playButton.innerHTML = '<i class="fas fa-play"></i>';
  videoContainer.appendChild(playButton);

  // สร้างปุ่มหยุด
  const stopButton = document.createElement('div');
  stopButton.className = 'video-stop-button';
  stopButton.innerHTML = '<i class="fas fa-pause"></i>'; // เปลี่ยนจาก stop เป็น pause
  stopButton.style.display = 'none'; // ซ่อนไว้ก่อน
  videoContainer.appendChild(stopButton);
  
  // ฟังก์ชันแสดงปุ่มเล่น
  function showPlayButton() {
    playButton.style.display = 'flex';
    stopButton.style.display = 'none';
  }
  
  // ฟังก์ชันซ่อนปุ่มเล่น
  function hidePlayButton() {
    playButton.style.display = 'none';
    stopButton.style.display = 'flex';
  }
  
  // เริ่มต้นแสดงปุ่มเล่น
  showPlayButton();
  
  // ตัวแปรเก็บสถานะว่ากำลังเล่นอยู่หรือไม่
  let isPlaying = false;
  
  // การจัดการการเล่นวิดีโอ
  playButton.addEventListener('click', function() {
    if (videoPlayCount >= 2) {
      showCustomAlert('คุณดูวิดีโอนี้ครบ 2 ครั้งแล้ว', 'จำกัดการเล่น');
      return;
    }
    
    videoElement.play()
      .then(() => {
        hidePlayButton();
        isPlaying = true;
      })
      .catch(error => {
        console.error('Error playing video:', error);
      });
  });
  
  // การจัดการการหยุดวิดีโอ (เปลี่ยนเป็น pause แทน stop)
  stopButton.addEventListener('click', function() {
    videoElement.pause();
    showPlayButton();
    isPlaying = false;
  });
  
  // เมื่อวิดีโอเล่นจบ
  videoElement.addEventListener('ended', function() {
    isPlaying = false;
    // นับรอบเมื่อเล่นจบเท่านั้น
    videoPlayCount++;
    console.log(`เล่นจบรอบที่ ${videoPlayCount}`);
    
    if (videoPlayCount < 2) {
      showPlayButton(); // แสดงปุ่มเล่นอีกครั้งสำหรับครั้งที่สอง
    } else {
      showCustomAlert('คุณดูวิดีโอนี้ครบ 2 ครั้งแล้ว', 'จำกัดการเล่น');
    }
  });
  
  // ป้องกันการกรอเวลา
  videoElement.addEventListener('seeked', function() {
    // รีเซ็ตกลับไปที่ 0 หากพยายามกรอ
    if (isPlaying) {
      videoElement.currentTime = 0;
    }
  });
  
  videoElement.addEventListener('timeupdate', function() {
    // ป้องกันการกรอโดยการรีเซ็ตหากพยายามกรอ
    if (videoElement.currentTime > 0 && videoElement.paused && isPlaying) {
      videoElement.currentTime = 0;
    }
  });
}

    

// Add this function to your JavaScript code
// Function to display video sources for all media items
function displayVideoSources() {
    // Get all video elements in the media container
    const mediaItems = document.querySelectorAll('.media-item');
    console.log(`Found ${mediaItems.length} media items to process`);
    
    mediaItems.forEach((item, index) => {
      // Find video elements
      const videoElement = item.querySelector('video');
      const imageElement = item.querySelector('img');
      
      // Process element and extract information
      if (videoElement) {
        // Get the source element and its src attribute
        const sourceElement = videoElement.querySelector('source');
        if (sourceElement) {
          const sourcePath = sourceElement.getAttribute('src');
          console.log(`Found video source: ${sourcePath}`);
          
          // Extract information from the path pattern
          const infoText = extractInformationFromPath(sourcePath);
          
          // Check if source info already exists to prevent duplicates
          if (!item.querySelector('.source-path-info')) {
            // Create a source info element
            const sourceInfo = document.createElement('div');
            sourceInfo.className = 'source-path-info';
            sourceInfo.innerHTML = `<i class="fas fa-folder"></i> ${infoText}`;
            
            // Append to media content
            const mediaContent = item.querySelector('.media-content');
            if (mediaContent) {
              mediaContent.appendChild(sourceInfo);
              console.log(`Added source info to media item ${index}`);
            } else {
              console.log(`No media-content found for item ${index}`);
            }
          }
        } else {
          console.log(`No source element found for video in item ${index}`);
        }
      } else if (imageElement) {
        // Display image source path too
        const imagePath = imageElement.getAttribute('src');
        console.log(`Found image source: ${imagePath}`);
        
        // Extract information from the path pattern
        const infoText = extractInformationFromPath(imagePath);
        
        // Check if source info already exists to prevent duplicates
        if (!item.querySelector('.source-path-info')) {
          // Create a source info element
          const sourceInfo = document.createElement('div');
          sourceInfo.className = 'source-path-info';
          sourceInfo.innerHTML = `<i class="fas fa-folder"></i> ${infoText}`;
          
          // Append to media content
          const mediaContent = item.querySelector('.media-content');
          if (mediaContent) {
            mediaContent.appendChild(sourceInfo);
            console.log(`Added source info to media item ${index}`);
          } else {
            console.log(`No media-content found for item ${index}`);
          }
        }
      }
    });
  }
  
  // Function to extract information from path patterns
  function extractInformationFromPath(path) {
    // Check if path contains a pattern like /2/2 or /4/4
    const matches = path.match(/\/(\d+)\/\1/);
    
    if (matches && matches[1]) {
      // Extract the number and create info text
      const infoNumber = matches[1];
      return `Information ${infoNumber}`;
    }
    
    // If no specific pattern is found, return the original path
    return `Source: ${path}`;
  }
  
  // Initial displayVideoSources call on DOMContentLoaded
  document.addEventListener('DOMContentLoaded', function() {
    // Initial timeout for when the page first loads
    setTimeout(displayVideoSources, 500);
  });
        // Test data - scenarios with their correct answers
        const testScenarios = [
            { id: 1, answers: { eye: "E4", verbal: "V2", motor: "M6" } },
            { id: 2, answers: { eye: "E2", verbal: "V3", motor: "M5" } },
            { id: 3, answers: { eye: "E4", verbal: "V4", motor: "M6" } },
            { id: 4, answers: { eye: "E3", verbal: "V4", motor: "M6" } },
            { id: 5, answers: { eye: "E4", verbal: "V5", motor: "M6" } },
            { id: 6, answers: { eye: "E3", verbal: "V3", motor: "M6" } },
            { id: 7, answers: { eye: "E3", verbal: "V4", motor: "M6" } },
            { id: 8, answers: { eye: "E2", verbal: "V2", motor: "M4" } },
            { id: 9, answers: { eye: "E3", verbal: "V5", motor: "M6" } },
            { id: 10, answers: { eye: "Ec", verbal: "V5", motor: "M6" } },
            { id: 11, answers: { eye: "E4", verbal: "V4", motor: "M6" } },
            { id: 12, answers: { eye: "E1", verbal: "V3", motor: "M6" } },
            { id: 13, answers: { eye: "E2", verbal: "V2", motor: "M4" } },
            { id: 14, answers: { eye: "E2", verbal: "Vt", motor: "M1" } },
            { id: 15, answers: { eye: "E1", verbal: "Vt", motor: "M2" } },
            { id: 16, answers: { eye: "E1", verbal: "Vt", motor: "M3" } },
            { id: 17, answers: { eye: "E4", verbal: "Vt", motor: "M6" } },
            { id: 18, answers: { eye: "E1", verbal: "Vt", motor: "M1" } },
            { id: 19, answers: { eye: "Ec", verbal: "Vt", motor: "M6" } },
            { id: 20, answers: { eye: "E2", verbal: "V4", motor: "M6" } },
            { id: 21, answers: { eye: "E3", verbal: "V4", motor: "M6" } },
            { id: 22, answers: { eye: "Ec", verbal: "V5", motor: "M6" } }
        ];

        // Level mappings - which scenario belongs to which level
        const levelScenarios = {
            1: [3, 4, 5, 6, 9, 13],
            2: [1, 2, 7, 8, 10, 11, 12, 16, 22],
            3: [14, 15, 17, 18, 19, 20, 21]
        };

        // Quiz options for each category
        const quizOptions = {
            eye: [
                { id: "E4", text: "E 4 : Responsse spontaneously" },
                { id: "E3", text: "E 3 : Responsse to speech" },
                { id: "E2", text: "E 2 : Responsse to painh" },
                { id: "E1", text: "E 1 : No responsse" },
                { id: "Ec", text: "E c : Eye closed" }
            ],
            verbal: [
                { id: "V5", text: "V 5 : Oriented to time, plance and person" },
                { id: "V4", text: "V 4 : Confused" },
                { id: "V3", text: "V 3 : Inappropriate words" },
                { id: "V2", text: "V 2 : Incomprehensible sounds" },
                { id: "V1", text: "V 1 : No response" },
                { id: "Vt", text: "V t : Intubation" }
            ],
            motor: [
                { id: "M6", text: "M 6 : Obeys commands" },
                { id: "M5", text: "M 5 : Moves to loclized pain" },
                { id: "M4", text: "M 4 : Flexion withdrawal from pain" },
                { id: "M3", text: "M 3 : Abnormal flexion (decorticate)" },
                { id: "M2", text: "M 2 : Abnormal extension (decerebrate)" },
                { id: "M1", text: "M 1 : No response" }
            ]
        };

        // Global variables
        let currentLevel = 1;
        let currentScenarioIndex = 0;
        let selectedScenarios = [];
        let userSelections = {};
        let score = 0;
        let answeredQuestions = { eye: false, verbal: false, motor: false };

        // Function to get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                level: parseInt(params.get('level')) || 1
            };
        }

        // Function to randomly select 5 scenarios for the current level without repetition
        function selectRandomScenarios() {
            const availableScenarios = [...levelScenarios[currentLevel]];
            const selected = [];

            // Select 5 random scenarios (or less if not enough available)
            const count = Math.min(5, availableScenarios.length);

            for (let i = 0; i < count; i++) {
                const randomIndex = Math.floor(Math.random() * availableScenarios.length);
                const scenarioId = availableScenarios.splice(randomIndex, 1)[0];
                selected.push(scenarioId);
            }

            return selected;
        }

        // Function to create the quiz sections for the current scenario
        function createQuizSections() {
            const container = document.getElementById('quiz-sections-container');
            container.innerHTML = '';

            // Reset answered questions
            answeredQuestions = { eye: false, verbal: false, motor: false };
            userSelections = {};

            // Create each section (eye, verbal, motor)
            const sections = [
                { id: 'eye', title: 'Eye Opening' },
                { id: 'verbal', title: 'Verbal Response' },
                { id: 'motor', title: 'Motor Response' }
            ];

            sections.forEach(section => {
                const sectionElement = document.createElement('div');
                sectionElement.className = 'quiz-section';

                const titleElement = document.createElement('div');
                titleElement.className = 'quiz-title';
                titleElement.textContent = section.title;
                sectionElement.appendChild(titleElement);

                const optionsElement = document.createElement('div');
                optionsElement.className = 'quiz-options';

                quizOptions[section.id].forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'quiz-option';
                    optionElement.textContent = option.text;
                    optionElement.dataset.value = option.id;
                    optionElement.dataset.category = section.id;

                    optionElement.addEventListener('click', () => selectOption(optionElement, section.id));

                    optionsElement.appendChild(optionElement);
                });

                sectionElement.appendChild(optionsElement);

                // Add feedback section
                const feedbackElement = document.createElement('div');
                feedbackElement.className = 'quiz-feedback';
                feedbackElement.id = `feedback-${section.id}`;
                sectionElement.appendChild(feedbackElement);

                container.appendChild(sectionElement);
            });
        }

        // Function to select an option
        // Function to select an option
function selectOption(element, category) {
    // Get all options in this category
    const options = document.querySelectorAll(`.quiz-option[data-category="${category}"]`);

    // Remove selected class from all options
    options.forEach(option => {
        option.classList.remove('selected');
    });

    // Add selected class to clicked option
    element.classList.add('selected');

    // Store the selection
    userSelections[category] = element.dataset.value;
    
    // Enable the answer button if all categories have selections
    checkAllAnswered();
}

        // Function to check if all questions are answered
        function checkAllAnswered() {
            const allSelected = ['eye', 'verbal', 'motor'].every(category => 
                userSelections[category] !== undefined
            );
        
            // Enable/disable next button
            document.getElementById('next-button').disabled = !allSelected;
        }

        // Function to load a scenario
        function loadScenario(scenarioId) {
            const currentScenario = testScenarios.find(scenario => scenario.id === scenarioId);

            if (!currentScenario) {
                console.error(`Scenario with ID ${scenarioId} not found!`);
                return;
            }

            // Create media elements for this scenario
            createMediaElements(scenarioId);

            // Create quiz sections
            createQuizSections();

            // Update progress
            updateProgress();
        }

        // Function to create media elements for a scenario
function createMediaElements(scenarioId) {
    const mediaContainer = document.getElementById('media-container');
    mediaContainer.innerHTML = ''; // Clear previous content
  
    // Create image container (จะถูกแสดงก่อน - ด้านบน)
    const imageItem = document.createElement('div');
    imageItem.className = 'media-item';
  
    const imageHeader = document.createElement('div');
    imageHeader.className = 'media-header';
    imageHeader.innerHTML = `<span>สถานการณ์ - ภาพประกอบ</span> <span>สถานการณ์ ${currentScenarioIndex + 1}</span>`;
  
    const imageContent = document.createElement('div');
    imageContent.className = 'media-content';
  
    const image = document.createElement('img');
    image.className = 'media-image';
    image.src = `assets/test_v/${scenarioId}/${scenarioId}.jpg`;
    image.alt = `Situation Image`;
  
    imageContent.appendChild(image);
    imageItem.appendChild(imageHeader);
    imageItem.appendChild(imageContent);
    mediaContainer.appendChild(imageItem);
  
    // Create video container (จะถูกแสดงหลัง - ด้านล่าง)
    const videoItem = document.createElement('div');
    videoItem.className = 'media-item';
  
    const videoHeader = document.createElement('div');
    videoHeader.className = 'media-header';
    videoHeader.innerHTML = `<span>สถานการณ์ - วิดีโอ</span> <span>สถานการณ์ ${currentScenarioIndex + 1}</span>`;
  
    const videoContent = document.createElement('div');
    videoContent.className = 'media-content';
  
    // Add warning message
    const warningDiv = document.createElement('div');
    warningDiv.className = 'video-warning';
    warningDiv.innerHTML = '<i class="fas fa-exclamation-circle"></i> สามารถดูวิดีโอนี้ได้สูงสุด 2 ครั้งเท่านั้น';
    videoContent.appendChild(warningDiv);
  
    const video = document.createElement('video');
    video.className = 'media-video';
    video.innerHTML = `<source src="assets/test_v/${scenarioId}/${scenarioId}.mp4" type="video/mp4">`;
  
    videoContent.appendChild(video);
    videoItem.appendChild(videoHeader);
    videoItem.appendChild(videoContent);
    mediaContainer.appendChild(videoItem);
  
    // ตั้งค่าติดตามการเล่นวิดีโอแบบใหม่
    setupVideoTracking(video);
    
    // เริ่มจับเวลาเมื่อโหลดสถานการณ์ใหม่
    startTimer();
    
    // Call displayVideoSources after creating the media elements
    setTimeout(displayVideoSources, 100);
}

        // Function to update progress
        // Function to update progress
function updateProgress() {
    document.getElementById('current-scenario').textContent = currentScenarioIndex + 1;
    document.getElementById('current-score').textContent = score;

    // Update progress bar - fix the calculation to show 100% on the last question
    const progressPercentage = ((currentScenarioIndex + 1) / selectedScenarios.length) * 100;
    document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
}

        // Function to check answers
        function checkAnswers() {
            const currentScenarioId = selectedScenarios[currentScenarioIndex];
            const currentScenario = testScenarios.find(scenario => scenario.id === currentScenarioId);
        
            if (!currentScenario) {
                console.error(`Scenario ${currentScenarioId} not found!`);
                return false;
            }
        
            const isCorrect = (
                userSelections.eye === currentScenario.answers.eye &&
                userSelections.verbal === currentScenario.answers.verbal &&
                userSelections.motor === currentScenario.answers.motor
            );
        
            // Highlight correct/incorrect answers
            highlightAnswers(currentScenario.answers);
        
            // Remove this line to disable the pop-up
            // showAnswerSection(currentScenario.answers);
        
            return isCorrect;
        }

        // Function to highlight the correct and incorrect answers
        function highlightAnswers(correctAnswers) {
            const categories = ['eye', 'verbal', 'motor'];

            categories.forEach(category => {
                const options = document.querySelectorAll(`.quiz-option[data-category="${category}"]`);

                options.forEach(option => {
                    const optionValue = option.dataset.value;

                    // Add inactive class to all options
                    option.classList.add('inactive');

                    // If this is the selected option
                    if (optionValue === userSelections[category]) {
                        if (optionValue === correctAnswers[category]) {
                            option.classList.add('correct');
                        } else {
                            option.classList.add('incorrect');
                        }
                    }

                    // If this is the correct answer and it wasn't selected
                    if (optionValue === correctAnswers[category] && userSelections[category] !== correctAnswers[category]) {
                        option.classList.add('correct');
                    }
                });

                // Show feedback
                const feedbackElement = document.getElementById(`feedback-${category}`);

                if (userSelections[category] === correctAnswers[category]) {
                    feedbackElement.textContent = 'ถูกต้อง!';
                    feedbackElement.className = 'quiz-feedback correct';
                } else {
                    feedbackElement.textContent = `คำตอบที่ถูกต้องคือ ${correctAnswers[category]}`;
                    feedbackElement.className = 'quiz-feedback incorrect';
                }

                feedbackElement.style.display = 'block';
            });
        }

        // Replace or modify the showAnswerSection function
        function showAnswerSection(answers) {
            // Find the full text for each answer code
            const eyeFullText = quizOptions.eye.find(opt => opt.id === answers.eye)?.text || answers.eye;
            const verbalFullText = quizOptions.verbal.find(opt => opt.id === answers.verbal)?.text || answers.verbal;
            const motorFullText = quizOptions.motor.find(opt => opt.id === answers.motor)?.text || answers.motor;
            
            // Set values in the modal
            document.getElementById('modal-answer-eye').textContent = eyeFullText;
            document.getElementById('modal-answer-verbal').textContent = verbalFullText;
            document.getElementById('modal-answer-motor').textContent = motorFullText;
            
            // Update status text and class
            const statusElement = document.getElementById('answer-status');
            const isAllCorrect = (
                userSelections.eye === answers.eye && 
                userSelections.verbal === answers.verbal && 
                userSelections.motor === answers.motor
            );
            
            if (isAllCorrect) {
                statusElement.textContent = 'ถูกต้อง!';
                statusElement.className = 'answer-status correct';
            } else {
                statusElement.textContent = 'ไม่ถูกต้อง';
                statusElement.className = 'answer-status incorrect';
            }
            
            // Show the modal and overlay
            document.getElementById('modal-overlay').style.display = 'block';
            document.getElementById('answer-modal').style.display = 'block';
        }

// Replace or modify the hideAnswerSection function
function hideAnswerSection() {
    document.getElementById('modal-overlay').style.display = 'none';
    document.getElementById('answer-modal').style.display = 'none';
}


function handleNextClick() {
clearInterval(timerInterval); // เคลียร์ timer
    currentScenarioIndex++;
    
    // If all scenarios are completed, show results
    if (currentScenarioIndex >= selectedScenarios.length) {
      showResults();
      
      // Scroll to the result container when showing final results
      setTimeout(() => {
        document.getElementById('result-container').scrollIntoView({ behavior: 'smooth' });
      }, 100);
    } else {
      // Load the next scenario
      loadScenario(selectedScenarios[currentScenarioIndex]);
      
      // Reset button to "ตอบ" (Answer)
      const nextButton = document.getElementById('next-button');
      nextButton.textContent = 'ตอบ';
      nextButton.innerHTML = 'ตอบ <i class="fas fa-check"></i>';
      
      // Change event listener back
      nextButton.removeEventListener('click', handleNextClick);
      nextButton.addEventListener('click', handleAnswerClick);
      
      // Disable the button until all questions are answered
      nextButton.disabled = true;
      
      // Scroll to the top of the page for questions 1-4
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }
}

// ปรับปรุงฟังก์ชัน showResults
function showResults() {
    // ซ่อนส่วน media-container
    document.getElementById('media-container').style.display = 'none';
    
    // ซ่อนส่วนแบบทดสอบและปุ่มถัดไป
    document.getElementById('quiz-sections-container').style.display = 'none';
    document.getElementById('next-button').style.display = 'none';
  
    // ซ่อน progress container ที่แสดง "แบบทดสอบที่ 5/5"
    document.querySelector('.progress-container').style.display = 'none';
  
    // แสดงผลลัพธ์
    const resultContainer = document.getElementById('result-container');
    resultContainer.style.display = 'flex';
    resultContainer.style.flexDirection = 'column';
    resultContainer.style.alignItems = 'center';
    resultContainer.style.justifyContent = 'center';
    resultContainer.style.maxWidth = '600px';
    resultContainer.style.margin = '0 auto';
    resultContainer.style.padding = '30px';
    resultContainer.style.borderRadius = '15px';
    resultContainer.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.15)';
    resultContainer.style.background = 'linear-gradient(135deg, #ffffff, #f5f5f5)';
    
    // แสดงคะแนนสุดท้าย
    const finalScore = document.getElementById('final-score');
    finalScore.textContent = score;
    
    // สร้างอิลิเมนต์คะแนนรวมที่มีขนาดใหญ่และมีสไตล์
    const scoreDisplay = document.querySelector('.result-score');
    scoreDisplay.style.fontSize = '3rem';
    scoreDisplay.style.fontWeight = 'bold';
    scoreDisplay.style.marginBottom = '20px';
    scoreDisplay.style.color = '#2d3748';
    scoreDisplay.style.textShadow = '2px 2px 4px rgba(0,0,0,0.1)';
    
    // สร้างรูปแบบการแสดงผลที่เหมาะสมตามคะแนน
    const resultMessage = document.getElementById('result-message');
    const resultTitle = document.querySelector('.result-title');
    resultTitle.style.fontSize = '2rem';
    resultTitle.style.marginBottom = '25px';
    resultTitle.style.fontWeight = 'bold';
    resultTitle.style.color = '#2d3748';
    resultTitle.style.textAlign = 'center';

     // Create buttons container
    const buttonsContainer = document.createElement('div');
    buttonsContainer.className = 'result-buttons-container';
    
    // Always show home button
    // ปุ่มกลับไปหน้าแบบทดสอบ (แทนที่ปุ่มกลับหน้าหลักเดิม)
    const testButton = document.createElement('button');
    testButton.className = 'result-button test';
    testButton.innerHTML = '<i class="fas fa-arrow-left"></i> กลับไปหน้าแบบทดสอบ';
    testButton.onclick = function() {
        window.location.href = "/test.html";
    };
    buttonsContainer.appendChild(testButton);
    // Show different buttons based on score
    if (score >= 3 && currentLevel < 3) {
        // If passed and not on the last level, show "Next Level" button
        const nextLevelButton = document.createElement('button');
        nextLevelButton.className = 'result-button next-level';
        nextLevelButton.innerHTML = '<i class="fas fa-arrow-right"></i> ไป Level ' + (currentLevel + 1);
        nextLevelButton.onclick = function() {
            window.location.href = `/level.html?level=${currentLevel + 1}`;
        };
        buttonsContainer.appendChild(nextLevelButton);
    } else {
        // Otherwise show restart button
        const restartButton = document.createElement('button');
        restartButton.className = 'result-button restart';
        restartButton.innerHTML = '<i class="fas fa-redo"></i> ทำแบบทดสอบอีกครั้ง';
        restartButton.onclick = restartTest;
        buttonsContainer.appendChild(restartButton);
    }

    // Add buttons container to result container
    resultContainer.appendChild(buttonsContainer);
    
    // ปรับแต่งปุ่มให้ดูสวยงามขึ้น
    const buttons = document.querySelectorAll('.result-button');
    buttons.forEach(button => {
        button.style.margin = '10px';
        button.style.padding = '12px 24px';
        button.style.borderRadius = '8px';
        button.style.fontWeight = 'bold';
        button.style.transition = 'all 0.3s ease';
        button.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        button.style.cursor = 'pointer';
    });
    
    // ปรับแต่งข้อความและสีตามระดับคะแนน
    if (score <= 2) {
        // ข้อความสำหรับคะแนนต่ำ
        resultMessage.textContent = 'ไม่เป็นไร คุณสามารถทบทวนและทำใหม่ได้ ความเข้าใจจะพัฒนาขึ้นเรื่อยๆ';
        resultMessage.style.color = '#e53e3e';
        scoreDisplay.style.color = '#e53e3e';
        // ปรับสีปุ่มทำใหม่
        buttons[0].style.backgroundColor = '#e53e3e';
        buttons[0].style.color = 'white';
        buttons[0].style.border = 'none';
    } else if (score == 3) {
        // ข้อความสำหรับคะแนนปานกลาง
        resultMessage.textContent = 'ดีมาก คุณเข้าใจหลักการประเมิน GCS ได้ในระดับที่ดี';
        resultMessage.style.color = '#ecc94b';
        scoreDisplay.style.color = '#ecc94b';
        // ปรับสีปุ่มทำใหม่
        buttons[0].style.backgroundColor = '#ecc94b';
        buttons[0].style.color = 'white';
        buttons[0].style.border = 'none';
    } else {
        // ข้อความสำหรับคะแนนสูง
        resultMessage.textContent = 'ยอดเยี่ยมมาก! คุณมีความเข้าใจในการประเมิน GCS อย่างดีเยี่ยม';
        resultMessage.style.color = '#38a169';
        scoreDisplay.style.color = '#38a169';
        // ปรับสีปุ่มทำใหม่
        buttons[0].style.backgroundColor = '#38a169';
        buttons[0].style.color = 'white';
        buttons[0].style.border = 'none';
    }
    
    // ปรับแต่งปุ่มกลับหน้าหลัก
    buttons[1].style.backgroundColor = '#4299e1';
    buttons[1].style.color = 'white';
    buttons[1].style.border = 'none';
    
    // เพิ่ม hover effect ให้กับปุ่ม
    buttons.forEach(button => {
        button.onmouseover = function() {
            this.style.transform = 'translateY(-3px)';
            this.style.boxShadow = '0 7px 14px rgba(0, 0, 0, 0.15)';
        };
        button.onmouseout = function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        };
    });

    // เพิ่มการบันทึกผลลัพธ์ถ้าผ่าน
            const passingScore = 3; // คะแนนขั้นต่ำที่ถือว่าผ่าน
            if (score >= passingScore) {
                const passedLevels = JSON.parse(localStorage.getItem('passedLevels') || '{}');
                passedLevels[currentLevel] = true;
                localStorage.setItem('passedLevels', JSON.stringify(passedLevels));
                
                // แสดงข้อความพิเศษถ้าผ่าน
                if (currentLevel < 3) {
                    resultMessage.textContent += `\nตอนนี้คุณสามารถทำ Level ${currentLevel + 1} ได้แล้ว!`;
                }
            }
    
    // สร้างเอฟเฟกต์พิเศษสำหรับแสดงคะแนน
    const scoreElement = document.querySelector('.result-score');
    scoreElement.style.opacity = '0';
    scoreElement.style.transform = 'scale(0.5)';
    
    // แสดงคะแนนด้วยเอฟเฟกต์
    setTimeout(() => {
        scoreElement.style.transition = 'all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        scoreElement.style.opacity = '1';
        scoreElement.style.transform = 'scale(1)';
    }, 300);
    
    // แสดงข้อความด้วยเอฟเฟกต์เลื่อนขึ้น
    resultMessage.style.opacity = '0';
    resultMessage.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        resultMessage.style.transition = 'all 0.8s ease';
        resultMessage.style.opacity = '1';
        resultMessage.style.transform = 'translateY(0)';
    }, 600);
    
    // แสดงปุ่มด้วยเอฟเฟกต์เลื่อนขึ้น
    buttons.forEach((button, index) => {
        button.style.opacity = '0';
        button.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            button.style.transition = 'all 0.6s ease';
            button.style.opacity = '1';
            button.style.transform = 'translateY(0)';
        }, 900 + (index * 200));
    });
    
    // แสดงเอฟเฟกต์ Confetti หากคะแนนมากกว่าหรือเท่ากับ 3
    if (score >= 4) {
        createEpicConfetti();
    }
}

// เพิ่มฟังก์ชั่นพื้นฐานฉากหลัง
function addBackgroundEffects() {
    // สร้างฉากหลังกราเดียนต์สำหรับ result-container
    const container = document.querySelector('.content-container') || document.body;
    const bgEffect = document.createElement('div');
    bgEffect.className = 'result-background-effect';
    bgEffect.style.position = 'fixed';
    bgEffect.style.top = '0';
    bgEffect.style.left = '0';
    bgEffect.style.width = '100%';
    bgEffect.style.height = '100%';
    bgEffect.style.background = 'radial-gradient(circle at center, rgba(66, 153, 225, 0.15) 0%, rgba(56, 161, 105, 0.1) 35%, rgba(236, 201, 75, 0.05) 70%, transparent 100%)';
    bgEffect.style.zIndex = '-1';
    bgEffect.style.opacity = '0';
    bgEffect.style.transition = 'opacity 1s ease';
    
    container.appendChild(bgEffect);
    
    // Create subtle light particles floating upward
    const particlesContainer = document.createElement('div');
    particlesContainer.className = 'particles-container';
    particlesContainer.style.position = 'fixed';
    particlesContainer.style.bottom = '0';
    particlesContainer.style.left = '0';
    particlesContainer.style.width = '100%';
    particlesContainer.style.height = '100%';
    particlesContainer.style.zIndex = '-1';
    particlesContainer.style.opacity = '0';
    particlesContainer.style.transition = 'opacity 2s ease';
    
    // Create floating particles
    for (let i = 0; i < 30; i++) {
      const particle = document.createElement('div');
      particle.className = 'floating-particle';
      particle.style.position = 'absolute';
      particle.style.width = `${Math.random() * 8 + 2}px`;
      particle.style.height = particle.style.width;
      particle.style.borderRadius = '50%';
      particle.style.backgroundColor = `rgba(255, 255, 255, ${Math.random() * 0.15 + 0.05})`;
      particle.style.bottom = '-20px';
      particle.style.left = `${Math.random() * 100}%`;
      particle.style.animation = `float-up ${Math.random() * 15 + 10}s linear infinite`;
      particle.style.animationDelay = `${Math.random() * 10}s`;
      
      particlesContainer.appendChild(particle);
    }
    
    // Add floating animation
    const particleStyle = document.createElement('style');
    particleStyle.innerHTML = `
      @keyframes float-up {
        0% { transform: translateY(0) translateX(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 0.7; }
        100% { transform: translateY(-100vh) translateX(${Math.random() * 100 - 50}px); opacity: 0; }
      }
    `;
    document.head.appendChild(particleStyle);
    
    container.appendChild(particlesContainer);
    
    // Gradually show all background effects
    setTimeout(() => {
      bgEffect.style.opacity = '1';
    }, 300);
    
    setTimeout(() => {
      particlesContainer.style.opacity = '1';
    }, 800);
}

// ===== EPIC CONFETTI EFFECT =====
function createEpicConfetti() {
    addBackgroundEffects();
    
    // Add confetti styles if not present
    if (!document.getElementById('confetti-styles')) {
        const styleEl = document.createElement('style');
        styleEl.id = 'confetti-styles';
        styleEl.textContent = `
            @keyframes confetti-fall {
                0% { transform: translateY(-100vh) rotateZ(0deg); }
                100% { transform: translateY(100vh) rotateZ(360deg); }
            }
            
            @keyframes confetti-shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-10px) rotateZ(-5deg); }
                50% { transform: translateX(10px) rotateZ(5deg); }
                75% { transform: translateX(-5px) rotateZ(-2deg); }
            }
            
            @keyframes confetti-slow-down {
                0% { opacity: 1; }
                80% { opacity: 1; }
                100% { opacity: 0; }
            }
        `;
        document.head.appendChild(styleEl);
    }
    
    // Create confetti container
    const confettiContainer = document.createElement('div');
    confettiContainer.className = 'confetti-container';
    confettiContainer.style.position = 'fixed';
    confettiContainer.style.width = '100%';
    confettiContainer.style.height = '100%';
    confettiContainer.style.left = '0';
    confettiContainer.style.top = '0';
    confettiContainer.style.overflow = 'hidden';
    confettiContainer.style.pointerEvents = 'none';
    confettiContainer.style.zIndex = '9999';
    document.body.appendChild(confettiContainer);
    
    // Color schemes for confetti
    const colorSchemes = [
        // Pink & Purple scheme
        ['#FF69B4', '#DA70D6', '#BA55D3', '#9370DB', '#8A2BE2', '#FF1493', '#C71585'],
        // Primary colors with gold
        ['#FF0000', '#0000FF', '#FFFF00', '#00FF00', '#FFD700', '#FF4500', '#1E90FF'],
        // Cool blues and greens
        ['#00FFFF', '#00CED1', '#20B2AA', '#5F9EA0', '#48D1CC', '#4682B4', '#3CB371'],
        // Warm scheme
        ['#FF7F50', '#FF6347', '#FF4500', '#FF8C00', '#FFA500', '#FFD700', '#FFFF00']
    ];
    
    // Choose a random color scheme
    const colors = colorSchemes[Math.floor(Math.random() * colorSchemes.length)];
    
    // Confetti types
    const confettiTypes = ['circle', 'square', 'triangle', 'star', 'rectangle', 'rounded-square'];
    
    // Create confetti in multiple bursts
    createConfettiBurst(confettiContainer, colors, confettiTypes, 120); // Initial burst
    
    // Add delayed bursts
    setTimeout(() => createConfettiBurst(confettiContainer, colors, confettiTypes, 60), 700);
    setTimeout(() => createConfettiBurst(confettiContainer, colors, confettiTypes, 40), 1500);
    setTimeout(() => createConfettiBurst(confettiContainer, colors, confettiTypes, 30), 2500);
    
    // Create side cannon effect
    setTimeout(() => createSideConfettiCannon(confettiContainer, colors, confettiTypes, 'left'), 200);
    setTimeout(() => createSideConfettiCannon(confettiContainer, colors, confettiTypes, 'right'), 400);
    
    // Create spiral effect
    setTimeout(() => createConfettiSpiral(confettiContainer, colors, confettiTypes), 2000);
    
    // Add big celebration confetti towards the end
    setTimeout(() => {
        createBigConfetti(confettiContainer, colors);
    }, 1000);
    
    // Clean up after 12 seconds
    setTimeout(() => {
        confettiContainer.style.transition = 'opacity 1.5s ease';
        confettiContainer.style.opacity = '0';
        setTimeout(() => {
            confettiContainer.remove();
        }, 1500);
    }, 12000);
}

function createConfettiBurst(container, colors, types, count) {
    for (let i = 0; i < count; i++) {
        const confetti = createConfettiPiece(colors, types);
        // Random starting position
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.top = '0';
        
        // Random animations
        const fallDuration = Math.random() * 5 + 3;
        const shakeDuration = Math.random() * 2 + 1;
        const fallDelay = Math.random() * 0.5;
        
        confetti.style.animation = `
            confetti-fall ${fallDuration}s cubic-bezier(0.25, 1, 0.3, 1) ${fallDelay}s forwards,
            confetti-shake ${shakeDuration}s ease-in-out ${fallDelay}s infinite,
            confetti-slow-down ${fallDuration}s ease-in ${fallDelay}s forwards
        `;
        
        container.appendChild(confetti);
        
        // Remove element after animation
        setTimeout(() => {
            confetti.remove();
        }, (fallDuration + fallDelay) * 1000);
    }
}

function createSideConfettiCannon(container, colors, types, side) {
    const count = 40;
    const startX = side === 'left' ? '-10%' : '110%';
    const angleRange = side === 'left' ? [20, 70] : [110, 160];
    
    for (let i = 0; i < count; i++) {
        const confetti = createConfettiPiece(colors, types);
        confetti.style.left = startX;
        confetti.style.top = '60%';
        
        // Calculate angle and distance
        const angle = (Math.random() * (angleRange[1] - angleRange[0]) + angleRange[0]) * Math.PI / 180;
        const distance = Math.random() * 60 + 40;
        const x = Math.cos(angle) * distance;
        const y = Math.sin(angle) * distance;
        
        // Random animations
        const duration = Math.random() * 4 + 2;
        const delay = Math.random() * 0.3;
        
        // Custom animation for cannon effect
        const cannonKeyframe = `
            @keyframes cannon-${side}-${i} {
                0% { transform: translate(0, 0) scale(0.3); opacity: 1; }
                10% { transform: translate(${x * 0.1}vw, ${-y * 0.1}vh) scale(1); }
                60% { opacity: 1; }
                100% { transform: translate(${x}vw, ${-y}vh) rotate(${Math.random() * 720 - 360}deg) scale(0.5); opacity: 0; }
            }
        `;
        
        // Add keyframe
        const style = document.createElement('style');
        style.innerHTML = cannonKeyframe;
        document.head.appendChild(style);
        
        // Apply animation
        confetti.style.animation = `cannon-${side}-${i} ${duration}s cubic-bezier(.25, .46, .45, .94) ${delay}s forwards`;
        
        container.appendChild(confetti);
        
        // Remove after animation
        setTimeout(() => {
            confetti.remove();
            style.remove();
        }, (duration + delay) * 1000);
    }
}

function createConfettiSpiral(container, colors, types) {
    const count = 50;
    const centerX = 50; // Center of viewport
    const centerY = 50;
    
    for (let i = 0; i < count; i++) {
        const confetti = createConfettiPiece(colors, types);
        
        // Position at center
        confetti.style.left = `${centerX}%`;
        confetti.style.top = `${centerY}%`;
        
        // Create spiral keyframe for this specific particle
        const angle = (i / count) * Math.PI * 6; // 3 full rotations
        const radius = (i / count) * 50 + 10; // Increasing radius
        const finalX = centerX + Math.cos(angle) * radius;
        const finalY = centerY + Math.sin(angle) * radius;
        
        const spiralKeyframe = `
            @keyframes spiral-${i} {
                0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
                20% { opacity: 1; }
                100% { transform: translate(${finalX - centerX}vw, ${finalY - centerY}vh) rotate(${angle * 180 / Math.PI}deg) scale(0.8); opacity: 0; }
            }
        `;
        
        // Add keyframe
        const style = document.createElement('style');
        style.innerHTML = spiralKeyframe;
        document.head.appendChild(style);
        
        // Duration increases slightly with each particle for a trailing effect
        const duration = 4 + (i / count) * 2;
        
        // Apply animation
        confetti.style.animation = `spiral-${i} ${duration}s cubic-bezier(.25, .46, .45, .94) forwards`;
        
        container.appendChild(confetti);
        
        // Clean up
        setTimeout(() => {
            confetti.remove();
            style.remove();
        }, duration * 1000);
    }
}

function createBigConfetti(container, colors) {
    const count = 15;
    
    for (let i = 0; i < count; i++) {
        // Create larger confetti pieces
        const confetti = document.createElement('div');
        confetti.className = 'confetti-big';
        
        // Larger size
        const size = Math.random() * 30 + 20;
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        
        // Random shape (mostly circular or rounded for big pieces)
        confetti.style.borderRadius = `${Math.random() > 0.3 ? 50 : 10}%`;
        
        // Random color from scheme
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        // Add shimmer effect
        confetti.style.boxShadow = `0 0 10px 2px ${confetti.style.backgroundColor}`;
        confetti.style.opacity = '0.9';
        
        // Random position
        confetti.style.position = 'absolute';
        confetti.style.left = `${Math.random() * 100}%`;
        confetti.style.top = '-5%';
        
        // Add to container
        container.appendChild(confetti);
        
        // Create custom animation
        const fallDuration = Math.random() * 6 + 4;
        const wobbleDuration = Math.random() * 3 + 2;
        const delay = Math.random() * 2;
        
        const uniqueId = `big-confetti-${Date.now()}-${i}`;
        const keyframes = `
            @keyframes ${uniqueId}-fall {
                0% { transform: translateY(0) scale(0.5); opacity: 0.5; }
                10% { transform: translateY(10vh) scale(1); opacity: 0.9; }
                80% { opacity: 0.8; }
                100% { transform: translateY(105vh) scale(0.7); opacity: 0; }
            }
            
            @keyframes ${uniqueId}-wobble {
                0%, 100% { margin-left: 0; }
                50% { margin-left: ${Math.random() * 100 - 50}px; }
            }
        `;
        
        // Add keyframes
        const style = document.createElement('style');
        style.innerHTML = keyframes;
        document.head.appendChild(style);
        
        // Apply animations
        confetti.style.animation = `
            ${uniqueId}-fall ${fallDuration}s ease-in ${delay}s forwards,
            ${uniqueId}-wobble ${wobbleDuration}s ease-in-out ${delay}s infinite
        `;
        
        // Clean up
        setTimeout(() => {
            confetti.remove();
            style.remove();
        }, (fallDuration + delay) * 1000);
    }
}

function createConfettiPiece(colors, types) {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    
    // Random size (smaller for more natural look)
    const size = Math.random() * 10 + 5;
    confetti.style.width = `${size}px`;
    confetti.style.height = `${size}px`;
    
    // Random type/shape
    const type = types[Math.floor(Math.random() * types.length)];
    switch (type) {
        case 'circle':
            confetti.style.borderRadius = '50%';
            break;
        case 'square':
            // No border radius
            break;
        case 'triangle':
            confetti.style.width = '0';
            confetti.style.height = '0';
            confetti.style.borderLeft = `${size/2}px solid transparent`;
            confetti.style.borderRight = `${size/2}px solid transparent`;
            confetti.style.borderBottom = `${size}px solid ${colors[Math.floor(Math.random() * colors.length)]}`;
            confetti.style.backgroundColor = 'transparent';
            break;
        case 'star':
            confetti.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
            break;
        case 'rectangle':
            confetti.style.width = `${size * 2}px`;
            confetti.style.height = `${size}px`;
            break;
        case 'rounded-square':
            confetti.style.borderRadius = '20%';
            break;
    }
    
    // If not triangle (which already has color set)
    if (type !== 'triangle') {
        // Random color from palette
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    }
    
    // Other styling
    confetti.style.position = 'absolute';
    confetti.style.zIndex = '100';
    confetti.style.opacity = Math.random() * 0.5 + 0.5;
    
    // Add shine to some confetti
    if (Math.random() > 0.7) {
        confetti.style.boxShadow = `0 0 6px ${confetti.style.backgroundColor}`;
    }
    
    return confetti;
}

function restartTest() {
    // Reset all variables
    currentScenarioIndex = 0;
    score = 0;
    videoPlayCount = 0;
    clearInterval(timerInterval);
    userSelections = {};
    answeredQuestions = { eye: false, verbal: false, motor: false };

    // Hide results and show quiz content
    document.getElementById('result-container').style.display = 'none';
    document.getElementById('quiz-sections-container').style.display = 'block';
    document.getElementById('next-button').style.display = 'block';
    document.getElementById('media-container').style.display = 'flex';
    document.querySelector('.progress-container').style.display = 'block';

    // Reset button text
    const nextButton = document.getElementById('next-button');
    nextButton.textContent = 'ตอบ';
    nextButton.innerHTML = 'ตอบ <i class="fas fa-check"></i>';
    nextButton.disabled = true;
    nextButton.removeEventListener('click', handleNextClick);
    nextButton.addEventListener('click', handleAnswerClick);

    // Select new random scenarios
    selectedScenarios = selectRandomScenarios();

    // Load the first scenario
    if (selectedScenarios.length > 0) {
        loadScenario(selectedScenarios[currentScenarioIndex]);
    } else {
        console.error("No scenarios available!");
    }
}

// เพิ่มเอฟเฟกต์ลอยสำหรับปุ่มโฮม
const homeButton = document.querySelector('.home-button,.back-button');
homeButton.style.animation = 'float 3s ease-in-out infinite';

// Function to go to home page
function goToHome() {
    console.log("Going to home page");
    // Add home navigation here
    window.location.href = "/index.html";

    // Visual feedback for button click
    const homeButton = document.querySelector('.home-button');
    homeButton.style.transform = 'scale(0.9)';

    setTimeout(() => {
        homeButton.style.transform = 'scale(1.1)';
    }, 150);
}

// Function to go back to test selection page
function goBack() {
    console.log("Going Back");
    // Add home navigation here
    window.location.href = "/test.html";

    // Visual feedback for button click
    const homeButton = document.querySelector('.back-button');
    homeButton.style.transform = 'scale(0.9)';

    setTimeout(() => {
        homeButton.style.transform = 'scale(1.1)';
    }, 150);
}

// Function to set header video based on level
function setHeaderVideo() {
    const videoSource = document.getElementById('header-video-source');
    videoSource.src = `assets/video_bg/level${currentLevel}.mp4`;

    const headerVideo = document.querySelector('.header-video');
    headerVideo.load();
    headerVideo.play().catch(error => {
        console.log("Auto-play was prevented:", error);
    });
}

function handleAnswerClick() {
    // Lock all selections
    answeredQuestions = {
        eye: true,
        verbal: true,
        motor: true
    };
    
    // Make all non-selected options inactive
    ['eye', 'verbal', 'motor'].forEach(category => {
        const options = document.querySelectorAll(`.quiz-option[data-category="${category}"]`);
        options.forEach(option => {
            if (option.dataset.value !== userSelections[category]) {
                option.classList.add('inactive');
            }
        });
    });
    
    // Check answers and update
            
            // Check answers and update score
            const isCorrect = checkAnswers();
            if (isCorrect) {
                score++;
                document.getElementById('current-score').textContent = score;
            }
            
            // Change button text to "ถัดไป" (Next)
            const nextButton = document.getElementById('next-button');
            nextButton.textContent = 'ถัดไป';
            nextButton.innerHTML = 'ถัดไป <i class="fas fa-arrow-right"></i>';
            
            // Change event listener for the button
            nextButton.removeEventListener('click', handleAnswerClick);
            nextButton.addEventListener('click', handleNextClick);
            
            // Enable the button
            nextButton.disabled = false;
        }
        function setHeaderContent() {
            // Set header video
            const videoSource = document.getElementById('header-video-source');
            videoSource.src = `assets/video_bg/level${currentLevel}.mp4`;
        
            const headerVideo = document.querySelector('.header-video');
            headerVideo.load();
            headerVideo.play().catch(error => {
                console.log("Auto-play was prevented:", error);
            });
            
        
        }

        // Function to initialize the page
        function initPage() {
            const params = getUrlParams();
            currentLevel = params.level;
        
            // Set header content based on level
            setHeaderContent();
        
            // Select random scenarios
            selectedScenarios = selectRandomScenarios();
        
            // Load the first scenario
            if (selectedScenarios.length > 0) {
                loadScenario(selectedScenarios[currentScenarioIndex]);
            }
        
            // Change the button text to "ตอบ" (Answer)
            document.getElementById('next-button').textContent = 'ตอบ';
            document.getElementById('next-button').innerHTML = 'ตอบ <i class="fas fa-check"></i>';
            
            // Change event listener for the button
            document.getElementById('next-button').addEventListener('click', handleAnswerClick);
            
            // Add event listener for the modal overlay to close when clicked
        
            
            // Set header text
            
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            initPage();
        });
    </script>
    </body>

</html>