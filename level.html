<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCS Level Test - Faculty of Nursing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        /* Add this to your existing CSS styles */
        
        .source-path-info {
          margin-top: 10px;
          padding: 8px 12px;
          background-color: #f5f5f5;
          border-radius: 6px;
          font-size: 14px;
          color: #666;
          border-left: 3px solid #FF6B00;
          display: flex;
          align-items: center;
          gap: 5px;
        }
        
        .source-path-info i {
          color: #FF6B00;
        }
        
        /* Optional: add hover effect to make it more interactive */
        .source-path-info:hover {
          background-color: #fff9f0;
          color: #333;
        }
        
        body {
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            width: 100%;
            height: 550px;
            position: relative;
            background: #D84315;
            color: white;
            overflow: hidden;
            border-bottom: 4px solid #FF6B00;
        }
        
        .header-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(1.2) contrast(1.1);
        }
        
        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            z-index: 1;
        }
        
        .header-content {
            position: absolute;
            z-index: 2;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .header h1 {
            font-size: 36px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            margin-bottom: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .level-subtitle {
            font-size: 24px;
            color: #FFD700;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
        }
        
        .content-container {
            background-color: white;
            padding: 40px 25px;
            min-height: 500px;
            display: flex;
            flex-direction: row;
        }
        
        .media-container {
            display: flex;
            flex-direction: column;
            gap: 30px;
            margin-top: 20px;
            width: 60%;
        }
        
        .quiz-container {
            width: 40%;
            padding-left: 30px;
        }
        .answer-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 1100;
            max-width: 90%;
            width: 500px;
            display: none;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1050;
            display: none;
        }
        
        .answer-modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #D84315;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .answer-modal-item {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .answer-modal-category {
            font-weight: bold;
            width: 150px;
            color: #555;
        }
        
        .answer-modal-value {
            font-weight: bold;
            color: #FF6B00;
        }
        
        .answer-status {
            font-size: 22px;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
        }
        
        .answer-status.correct {
            color: #4CAF50;
        }
        
        .answer-status.incorrect {
            color: #F44336;
        }
        
        .media-item {
            background-color: #fff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .media-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .media-header {
            padding: 15px 20px;
            background-color: #FF6B00;
            color: white;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .media-content {
            padding: 20px;
        }
        
        .media-video {
            width: 100%;
            border-radius: 5px;
            max-height: 500px;
            object-fit: contain;
        }
        
        .media-image {
            width: 100%;
            max-height: 500px;
            object-fit: contain;
            border-radius: 5px;
        }
        
        .home-button {
            position: absolute; /* Positioned within the header */
            top: 20px;
            left: 20px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.9); /* White with slight transparency */
            color: #FF6B00; /* Orange icon color for contrast */
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Softer shadow */
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6); /* Subtle border */
        }
        
        .home-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
            background-color: white; /* Fully white on hover */
            color: #FFD700; /* Gold color on hover */
            border-color: white;
        }
        
        .home-button i {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .home-button:hover i {
            transform: scale(1.2);
        }
        
        .home-button::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.2) 0%, rgba(255, 255, 255, 0) 70%);
            border-radius: 50%;
            transform: scale(0);
            transition: 0.5s;
        }
        
        .home-button:hover::before {
            transform: scale(2);
            opacity: 0;
        }
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
        
            50% {
                transform: translateY(-10px);
            }
        
            100% {
                transform: translateY(0px);
            }
        }
        
        .home-button-text {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            left: 80px;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.3s ease;
        }
        
        .home-button:hover .home-button-text {
            opacity: 1;
            transform: translateX(0);
        }
        
        .back-button {
            position: absolute; /* Positioned within the header */
            top: 20px;
            right: 20px;
            z-index: 1000;
            background-color: rgba(255, 255, 255, 0.9); /* White with slight transparency */
            color: #FF6B00; /* Orange icon color for contrast */
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); /* Softer shadow */
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.6); /* Subtle border */
        }
        
        .back-button:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.25);
            background-color: white;
            color: #FFD700;
            border-color: white;
        }
        
        .back-button i {
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .back-button::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.2) 0%, rgba(255,255,255,0) 70%); /* Subtle gold glow */
            border-radius: 50%;
            transform: scale(0);
            transition: 0.5s;
        }
        
        .back-button:hover::before {
            transform: scale(2);
            opacity: 0;
        }
        
        
        .back-button:hover i {
            transform: scale(1.2);
        
        }
        
                @keyframes float {
                    0% {
                        transform: translateY(0px);
                    }
        
                    50% {
                        transform: translateY(-10px);
                    }
        
                    100% {
                        transform: translateY(0px);
                    }
                }
        
        .back-button-text {
            position: absolute;
            background-color: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            right: 80px;
            opacity: 0;
            transform: translateX(20px);
            transition: all 0.3s ease;
        }
        
        .back-button:hover .back-button-text {
            opacity: 1;
            transform: translateX(0);
        }
        
        /* UPDATED: Increased button size and padding */
        .next-button {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B00, #FF9100);
            color: white;
            padding: 18px 32px;  /* Increased from 14px 28px */
            border-radius: 30px;
            font-weight: bold;
            font-size: 20px;  /* Increased from 18px */
            margin-top: 25px;  /* Increased from 20px */
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 6px 12px rgba(255, 107, 0, 0.3);
            text-align: center;
            width: 100%;
            border: none;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;  /* Added for better readability */
        }
        
        .next-button:hover {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #333;
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(255, 170, 0, 0.4);
        }
        
        .next-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }
        
        .next-button:hover:before {
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
        
        .next-button i {
            margin-left: 10px;  /* Increased from 8px */
            font-size: 22px;  /* Added font size for icon */
        }
        
        .next-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        
        .footer {
            padding: 20px;
            text-align: center;
            background-color: #333;
            color: white;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 15px;
        }
        
        .university-footer-logo {
            height: 50px;
            width: auto;
            border-radius: 4px;
            margin-right: 15px;
        }
        
        .footer-text {
            font-weight: bold;
            font-size: 16px;
        }
        
        .quiz-section {
            margin-bottom: 30px;
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: white;
            background-color: #D84315;
            padding: 10px 15px;
            border-radius: 8px;
        }
        
        /* UPDATED: Increased option size */
        .quiz-option {
            padding: 18px 22px;  /* Increased from 16px 20px */
            font-size: 18px;
            margin-bottom: 12px;
            transition: all 0.2s ease;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .quiz-option:hover {
            transform: translateX(8px);
            background-color: rgba(255, 107, 0, 0.1);
        }
        
        .quiz-option.selected {
            background-color: rgba(255, 107, 0, 0.2);
            border-left: 4px solid #FF6B00;
        }
        
        .quiz-option.correct {
            background-color: rgba(76, 175, 80, 0.2);
            border-left: 4px solid #4CAF50;
        }
        
        .quiz-option.incorrect {
            background-color: rgba(244, 67, 54, 0.2);
            border-left: 4px solid #F44336;
        }
        
        .quiz-option.inactive {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }
        
        .quiz-feedback {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .quiz-feedback.correct {
            background-color: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            color: #2E7D32;
        }
        
        .quiz-feedback.incorrect {
            background-color: rgba(244, 67, 54, 0.1);
            border: 1px solid #F44336;
            color: #C62828;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #F44336;
        }
        
        .progress-container {
            margin-bottom: 30px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgb(246, 246, 246);
        }
        
        .progress-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: #FF6B00;
            border-radius: 6px;
            transition: width 0.5s ease;
        }
        
        .progress-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .result-container {
            text-align: center;
            padding: 30px;
            background-color: #f8f8f8;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgb(255, 255, 255);
            display: none;
        }
        
        .result-title {
            font-size: 28px;
            color: #D84315;
            margin-bottom: 20px;
        }
        
        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #FF6B00;
            margin-bottom: 20px;
        }
        
        .result-message {
            font-size: 18px;
            margin-bottom: 30px;
            color: #333;
        }
        
        .result-button {
            display: inline-block;
            background: linear-gradient(135deg, #FF6B00, #FF9100);
            color: white;
            padding: 18px 32px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: 0 6px 15px rgba(255, 107, 0, 0.4);
            margin: 15px;
            border: none;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            min-width: 220px;
        }
        
        .result-button:hover {
            background: linear-gradient(135deg, #FFD700, #FFA000);
            color: #333;
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 10px 20px rgba(255, 170, 0, 0.5);
        }
        
        .result-button:active {
            transform: translateY(2px);
            box-shadow: 0 4px 10px rgba(255, 107, 0, 0.3);
        }
        
        .result-button:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
        }
        
        .result-button:hover:before {
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }
        
        /* เพิ่มไอคอนใน HTML หรือใช้ CSS pseudo-elements */
        .result-button.restart:before {
            font-family: "Font Awesome 5 Free"; /* ต้องมีการเรียกใช้ Font Awesome */
            content: "\f2f1";
            margin-right: 10px;
        }
        
        .result-button.home:before {
            font-family: "Font Awesome 5 Free";
            content: "\f015";
            margin-right: 10px;
        }
        
        /* ปรับแต่ง container ที่บรรจุปุ่ม */
        .result-buttons-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 30px;
        }
        /* Responsive design สำหรับปุ่ม */
@media (max-width: 768px) {
    .result-button {
        padding: 20px 36px;
        font-size: 22px;
        margin: 12px;
        min-width: 240px;
    }
}

@media (max-width: 480px) {
    .result-button {
        display: block;
        width: 100%;
        max-width: 280px;
        margin: 15px auto;
    }
    
    .result-buttons-container {
        flex-direction: column;
        align-items: center;
    }
}
        
        /* Answer section styling - UPDATED with larger dimensions */
        .answer-section {
            margin: 25px 0;  /* Increased from 20px */
            padding: 25px;  /* Increased from 20px */
            background-color: #fff9f0;
            border-radius: 12px;  /* Increased from 10px */
            border-left: 6px solid #FF6B00;  /* Increased from 5px */
            box-shadow: 0 4px 12px rgb(255, 255, 255);  /* Enhanced shadow */
            display: none;
            width: 100%;
            max-width: 650px;  /* Increased from 600px */
            margin-left: auto;
            margin-right: auto;
        }
        
        .answer-title {
            font-size: 24px;  /* Increased from 22px */
            font-weight: bold;
            margin-bottom: 18px;  /* Increased from 15px */
            color: #D84315;
            text-align: center;
        }
        
        .answer-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;  /* Increased from 10px */
            padding-bottom: 12px;  /* Increased from 10px */
            border-bottom: 1px solid #eee;
        }
        
        .answer-item:last-child {
            border-bottom: none;
        }
        
        .answer-category {
            font-weight: bold;
            width: 130px;  /* Increased from 120px */
            color: #555;
            font-size: 16px;  /* Added font size */
        }
        
        .answer-value {
            font-weight: bold;
            color: #FF6B00;
            font-size: 16px;  /* Added font size */
        }
        
        
        /* Responsive adjustments */
        @media (max-width: 992px) {
            .content-container {
                flex-direction: column;
            }
        
            .media-container,
            .answer-section {
                width: 100%;
            }
        
            .quiz-container {
                width: 100%;
                padding-left: 0;
                margin-top: 20px;
            }
        
            .answer-section {
                margin-top: 0;
                margin-bottom: 20px;
            }
            
            /* UPDATED: Make next button even larger on tablets */
            .next-button {
                padding: 20px 35px;
                font-size: 22px;
            }
        }
        
        @media (max-width: 767px) {
            .header {
                height: 250px;
            }
        
            .header h1 {
                font-size: 28px;
            }
        
            .level-subtitle {
                font-size: 20px;
            }
        
            .home-button,
            .back-button {
                width: 50px;
                height: 50px;
            }
        
            .home-button i,
            .back-button i {
                font-size: 20px;
            }
        
            .media-header {
                font-size: 16px;
                padding: 12px 15px;
            }
        
            .content-container {
                padding: 25px 15px;
            }
        
            /* UPDATED: Increased size on mobile */
            .next-button {
                padding: 18px 25px;
                font-size: 18px;
                margin-bottom: 10px;
            }
        
            .quiz-title {
                font-size: 28px;
                padding: 15px 20px;
            }
            
            /* UPDATED: Increased answer section size on mobile */
            .answer-section {
                padding: 20px;
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                height: 200px;
            }
        
            .header h1 {
                font-size: 24px;
            }
        
            .level-subtitle {
                font-size: 18px;
            }
        
            .home-button,
            .back-button {
                width: 40px;
                height: 40px;
                top: 15px;
            }
        
            .home-button i,
            .back-button i {
                font-size: 18px;
            }
        
            .home-button {
                left: 15px;
            }
        
            .back-button {
                right: 15px;
            }
        
            .media-header {
                font-size: 14px;
                padding: 10px;
            }
        
            .media-content {
                padding: 15px;
            }
        
            .footer-text {
                font-size: 14px;
            }
        
            .quiz-title {
                font-size: 22px;
                padding: 12px 15px;
            }
        
            /* UPDATED: Still maintain larger size on small screens */
            .quiz-option {
                padding: 15px 18px;
                font-size: 16px;
                margin-bottom: 10px;
            }
            
            /* UPDATED: Ensure next button remains prominent on small screens */
            .next-button {
                padding: 16px 22px;
                font-size: 18px;
                margin-top: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <!-- Home Button -->
            <div class="home-button" onclick="goToHome()">
                <i class="fas fa-home"></i>
                <span class="home-button-text">หน้าหลัก</span>
            </div>

            <!-- Back Button -->
            <div class="back-button" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                <span class="back-button-text">กลับ</span>
            </div>

            <video class="header-video" autoplay muted loop playsinline>
                <source src="" type="video/mp4" id="header-video-source">
                Your browser does not support the video tag.
            </video>
            <div class="header-overlay"></div>
            <div class="header-content">
                
            </div>
        </div>

        <!-- Content Container -->
        <div class="content-container">
            <div class="media-container" id="media-container">
                <!-- Media items will be dynamically added here -->

            </div>
            <div class="modal-overlay" id="modal-overlay"></div>
<div class="answer-modal" id="answer-modal">
    <i class="fas fa-times modal-close" id="modal-close" onclick="hideAnswerSection()"></i>
    <div class="answer-modal-title">เฉลยคำตอบ</div>
    <div class="answer-status" id="answer-status">ถูกต้อง!</div>
    <div class="answer-modal-item">
        <div class="answer-modal-category">Eye Opening:</div>
        <div class="answer-modal-value" id="modal-answer-eye"></div>
    </div>
    <div class="answer-modal-item">
        <div class="answer-modal-category">Verbal Response:</div>
        <div class="answer-modal-value" id="modal-answer-verbal"></div>
    </div>
    <div class="answer-modal-item">
        <div class="answer-modal-category">Motor Response:</div>
        <div class="answer-modal-value" id="modal-answer-motor"></div>
    </div>
</div>

            <div class="quiz-container" id="quiz-container">
                <!-- Progress tracker -->
                <div class="progress-container">
                    <div class="progress-title">แบบทดสอบที่ <span id="current-scenario">1</span>/5</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progress-bar" style="width: 20%;"></div>
                    </div>
                    <div class="progress-stats">
                        <div>คะแนน: <span id="current-score">0</span>/5</div>
                    </div>
                </div>

                <!-- Quiz sections will be dynamically added here -->
                <div id="quiz-sections-container"></div>

                <!-- Next button -->
                <button class="next-button" id="next-button" disabled>
                    ถัดไป <i class="fas fa-arrow-right"></i>
                </button>

                <!-- Results container (hidden initially) -->
                <div class="result-container" id="result-container">
                    <div class="result-title">ผลการทดสอบ</div>
                    <div class="result-score"><span id="final-score">0</span>/5</div>
                    <div class="result-message" id="result-message">คุณทำได้ดีมาก!</div>
                    <button class="result-button" onclick="restartTest()">
                        ทำแบบทดสอบอีกครั้ง
                    </button>
                    <button class="result-button" onclick="goToHome()">
                        กลับหน้าหลัก
                    </button>
                </div>
            </div>
        </div>

        <!-- Answer Section (hidden initially) -->


        <!-- Footer -->
        <div class="footer">
            <img src="assest/images/university_logo.jpg" alt="University Logo" class="university-footer-logo">
            <span class="footer-text">GCS SSKRU Faculty of nursing</span>
        </div>
    </div>

    <script>

// Add this function to your JavaScript code
// Function to display video sources for all media items
function displayVideoSources() {
    // Get all video elements in the media container
    const mediaItems = document.querySelectorAll('.media-item');
    console.log(`Found ${mediaItems.length} media items to process`);
    
    mediaItems.forEach((item, index) => {
      // Find video elements
      const videoElement = item.querySelector('video');
      const imageElement = item.querySelector('img');
      
      if (videoElement) {
        // Get the source element and its src attribute
        const sourceElement = videoElement.querySelector('source');
        if (sourceElement) {
          const sourcePath = sourceElement.getAttribute('src');
          console.log(`Found video source: ${sourcePath}`);
          
          // Check if source info already exists to prevent duplicates
          if (!item.querySelector('.source-path-info')) {
            // Create a source info element
            const sourceInfo = document.createElement('div');
            sourceInfo.className = 'source-path-info';
            sourceInfo.innerHTML = `<i class="fas fa-folder"></i> Source: ${sourcePath}`;
            
            // Append to media content
            const mediaContent = item.querySelector('.media-content');
            if (mediaContent) {
              mediaContent.appendChild(sourceInfo);
              console.log(`Added source info to media item ${index}`);
            } else {
              console.log(`No media-content found for item ${index}`);
            }
          }
        } else {
          console.log(`No source element found for video in item ${index}`);
        }
      } else if (imageElement) {
        // Display image source path too
        const imagePath = imageElement.getAttribute('src');
        console.log(`Found image source: ${imagePath}`);
        
        // Check if source info already exists to prevent duplicates
        if (!item.querySelector('.source-path-info')) {
          // Create a source info element
          const sourceInfo = document.createElement('div');
          sourceInfo.className = 'source-path-info';
          sourceInfo.innerHTML = `<i class="fas fa-folder"></i> Source: ${imagePath}`;
          
          // Append to media content
          const mediaContent = item.querySelector('.media-content');
          if (mediaContent) {
            mediaContent.appendChild(sourceInfo);
            console.log(`Added source info to media item ${index}`);
          } else {
            console.log(`No media-content found for item ${index}`);
          }
        }
      }
    });
  }
// Initial displayVideoSources call on DOMContentLoaded
document.addEventListener('DOMContentLoaded', function() {
    // Initial timeout for when the page first loads
    setTimeout(displayVideoSources, 500);
  });
        // Test data - scenarios with their correct answers
        const testScenarios = [
            { id: 1, answers: { eye: "E4", verbal: "V2", motor: "M6" } },
            { id: 2, answers: { eye: "E2", verbal: "V3", motor: "M5" } },
            { id: 3, answers: { eye: "E4", verbal: "V4", motor: "M6" } },
            { id: 4, answers: { eye: "E3", verbal: "V4", motor: "M6" } },
            { id: 5, answers: { eye: "E4", verbal: "V5", motor: "M6" } },
            { id: 6, answers: { eye: "E3", verbal: "V3", motor: "M6" } },
            { id: 7, answers: { eye: "E3", verbal: "V4", motor: "M6" } },
            { id: 8, answers: { eye: "E2", verbal: "V2", motor: "M4" } },
            { id: 9, answers: { eye: "E3", verbal: "V5", motor: "M6" } },
            { id: 10, answers: { eye: "Ec", verbal: "V5", motor: "M6" } },
            { id: 11, answers: { eye: "E4", verbal: "V4", motor: "M6" } },
            { id: 12, answers: { eye: "E1", verbal: "V3", motor: "M6" } },
            { id: 13, answers: { eye: "E2", verbal: "V2", motor: "M4" } },
            { id: 14, answers: { eye: "E2", verbal: "Vt", motor: "M1" } },
            { id: 15, answers: { eye: "E1", verbal: "Vt", motor: "M2" } },
            { id: 16, answers: { eye: "E1", verbal: "Vt", motor: "M3" } },
            { id: 17, answers: { eye: "E4", verbal: "Vt", motor: "M6" } },
            { id: 18, answers: { eye: "E1", verbal: "Vt", motor: "M1" } },
            { id: 19, answers: { eye: "Ec", verbal: "Vt", motor: "M6" } },
            { id: 20, answers: { eye: "E2", verbal: "V4", motor: "M6" } },
            { id: 21, answers: { eye: "E3", verbal: "V4", motor: "M6" } },
            { id: 22, answers: { eye: "Ec", verbal: "V5", motor: "M6" } }
        ];

        // Level mappings - which scenario belongs to which level
        const levelScenarios = {
            1: [3, 4, 5, 6, 9, 13],
            2: [1, 2, 7, 8, 10, 11, 12, 16, 22],
            3: [14, 15, 17, 18, 19, 20, 21]
        };

        // Quiz options for each category
        const quizOptions = {
            eye: [
                { id: "E4", text: "E 4 : Responsse spontaneously" },
                { id: "E3", text: "E 3 : Responsse to speech" },
                { id: "E2", text: "E 2 : Responsse to painh" },
                { id: "E1", text: "E 1 : No responsse" },
                { id: "Ec", text: "E c : Eye closed" }
            ],
            verbal: [
                { id: "V5", text: "V 5 : Oriented to time, plance and person" },
                { id: "V4", text: "V 4 : Confused" },
                { id: "V3", text: "V 3 : Inappropriate words" },
                { id: "V2", text: "V 2 : Incomprehensible sounds" },
                { id: "V1", text: "V 1 : No response" },
                { id: "Vt", text: "V t : Intubation" }
            ],
            motor: [
                { id: "M6", text: "M 6 : Obeys commands" },
                { id: "M5", text: "M 5 : Moves to loclized pain" },
                { id: "M4", text: "M 4 : Flexion withdrawal from pain" },
                { id: "M3", text: "M 3 : Abnormal flexion (decorticate)" },
                { id: "M2", text: "M 2 : Abnormal extension (decerebrate)" },
                { id: "M1", text: "M 1 : No response" }
            ]
        };

        // Global variables
        let currentLevel = 1;
        let currentScenarioIndex = 0;
        let selectedScenarios = [];
        let userSelections = {};
        let score = 0;
        let answeredQuestions = { eye: false, verbal: false, motor: false };

        // Function to get URL parameters
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                level: parseInt(params.get('level')) || 1
            };
        }

        // Function to randomly select 5 scenarios for the current level without repetition
        function selectRandomScenarios() {
            const availableScenarios = [...levelScenarios[currentLevel]];
            const selected = [];

            // Select 5 random scenarios (or less if not enough available)
            const count = Math.min(5, availableScenarios.length);

            for (let i = 0; i < count; i++) {
                const randomIndex = Math.floor(Math.random() * availableScenarios.length);
                const scenarioId = availableScenarios.splice(randomIndex, 1)[0];
                selected.push(scenarioId);
            }

            return selected;
        }

        // Function to create the quiz sections for the current scenario
        function createQuizSections() {
            const container = document.getElementById('quiz-sections-container');
            container.innerHTML = '';

            // Reset answered questions
            answeredQuestions = { eye: false, verbal: false, motor: false };
            userSelections = {};

            // Create each section (eye, verbal, motor)
            const sections = [
                { id: 'eye', title: 'Eye Opening' },
                { id: 'verbal', title: 'Verbal Response' },
                { id: 'motor', title: 'Motor Response' }
            ];

            sections.forEach(section => {
                const sectionElement = document.createElement('div');
                sectionElement.className = 'quiz-section';

                const titleElement = document.createElement('div');
                titleElement.className = 'quiz-title';
                titleElement.textContent = section.title;
                sectionElement.appendChild(titleElement);

                const optionsElement = document.createElement('div');
                optionsElement.className = 'quiz-options';

                quizOptions[section.id].forEach(option => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'quiz-option';
                    optionElement.textContent = option.text;
                    optionElement.dataset.value = option.id;
                    optionElement.dataset.category = section.id;

                    optionElement.addEventListener('click', () => selectOption(optionElement, section.id));

                    optionsElement.appendChild(optionElement);
                });

                sectionElement.appendChild(optionsElement);

                // Add feedback section
                const feedbackElement = document.createElement('div');
                feedbackElement.className = 'quiz-feedback';
                feedbackElement.id = `feedback-${section.id}`;
                sectionElement.appendChild(feedbackElement);

                container.appendChild(sectionElement);
            });
        }

        // Function to select an option
        // Function to select an option
function selectOption(element, category) {
    // Get all options in this category
    const options = document.querySelectorAll(`.quiz-option[data-category="${category}"]`);

    // Remove selected class from all options
    options.forEach(option => {
        option.classList.remove('selected');
    });

    // Add selected class to clicked option
    element.classList.add('selected');

    // Store the selection
    userSelections[category] = element.dataset.value;
    
    // Enable the answer button if all categories have selections
    checkAllAnswered();
}

        // Function to check if all questions are answered
        function checkAllAnswered() {
            const allSelected = ['eye', 'verbal', 'motor'].every(category => 
                userSelections[category] !== undefined
            );
        
            // Enable/disable next button
            document.getElementById('next-button').disabled = !allSelected;
        }

        // Function to load a scenario
        function loadScenario(scenarioId) {
            const currentScenario = testScenarios.find(scenario => scenario.id === scenarioId);

            if (!currentScenario) {
                console.error(`Scenario with ID ${scenarioId} not found!`);
                return;
            }

            // Create media elements for this scenario
            createMediaElements(scenarioId);

            // Create quiz sections
            createQuizSections();

            // Update progress
            updateProgress();
        }

        // Function to create media elements for a scenario
        function createMediaElements(scenarioId) {
            const mediaContainer = document.getElementById('media-container');
            mediaContainer.innerHTML = ''; // Clear previous content
          
            // Create video container
            const videoItem = document.createElement('div');
            videoItem.className = 'media-item';
          
            const videoHeader = document.createElement('div');
            videoHeader.className = 'media-header';
            videoHeader.innerHTML = `<span>สถานการณ์ - วิดีโอ</span> <span>สถานการณ์ ${currentScenarioIndex + 1}</span>`;
          
            const videoContent = document.createElement('div');
            videoContent.className = 'media-content';
          
            const video = document.createElement('video');
            video.className = 'media-video';
            video.controls = true;
            video.innerHTML = `<source src="assest/test_v/${scenarioId}/${scenarioId}.mp4" type="video/mp4">`;
          
            videoContent.appendChild(video);
            videoItem.appendChild(videoHeader);
            videoItem.appendChild(videoContent);
            mediaContainer.appendChild(videoItem);
          
            // Create image container
            const imageItem = document.createElement('div');
            imageItem.className = 'media-item';
          
            const imageHeader = document.createElement('div');
            imageHeader.className = 'media-header';
            imageHeader.innerHTML = `<span>สถานการณ์ - ภาพประกอบ</span> <span>สถานการณ์ ${currentScenarioIndex + 1}</span>`;
          
            const imageContent = document.createElement('div');
            imageContent.className = 'media-content';
          
            const image = document.createElement('img');
            image.className = 'media-image';
            image.src = `assest/test_v/${scenarioId}/${scenarioId}.jpg`;
            image.alt = `Situation Image`;
          
            imageContent.appendChild(image);
            imageItem.appendChild(imageHeader);
            imageItem.appendChild(imageContent);
            mediaContainer.appendChild(imageItem);
            
            // Call displayVideoSources after creating the media elements
            // Add a short delay to ensure DOM is updated
            setTimeout(displayVideoSources, 100);
          }

        // Function to update progress
        function updateProgress() {
            document.getElementById('current-scenario').textContent = currentScenarioIndex + 1;
            document.getElementById('current-score').textContent = score;

            // Update progress bar
            const progressPercentage = ((currentScenarioIndex) / 5) * 100;
            document.getElementById('progress-bar').style.width = `${progressPercentage}%`;
        }

        // Function to check answers
        function checkAnswers() {
            const currentScenarioId = selectedScenarios[currentScenarioIndex];
            const currentScenario = testScenarios.find(scenario => scenario.id === currentScenarioId);
        
            if (!currentScenario) {
                console.error(`Scenario ${currentScenarioId} not found!`);
                return false;
            }
        
            const isCorrect = (
                userSelections.eye === currentScenario.answers.eye &&
                userSelections.verbal === currentScenario.answers.verbal &&
                userSelections.motor === currentScenario.answers.motor
            );
        
            // Highlight correct/incorrect answers
            highlightAnswers(currentScenario.answers);
        
            // Remove this line to disable the pop-up
            // showAnswerSection(currentScenario.answers);
        
            return isCorrect;
        }

        // Function to highlight the correct and incorrect answers
        function highlightAnswers(correctAnswers) {
            const categories = ['eye', 'verbal', 'motor'];

            categories.forEach(category => {
                const options = document.querySelectorAll(`.quiz-option[data-category="${category}"]`);

                options.forEach(option => {
                    const optionValue = option.dataset.value;

                    // Add inactive class to all options
                    option.classList.add('inactive');

                    // If this is the selected option
                    if (optionValue === userSelections[category]) {
                        if (optionValue === correctAnswers[category]) {
                            option.classList.add('correct');
                        } else {
                            option.classList.add('incorrect');
                        }
                    }

                    // If this is the correct answer and it wasn't selected
                    if (optionValue === correctAnswers[category] && userSelections[category] !== correctAnswers[category]) {
                        option.classList.add('correct');
                    }
                });

                // Show feedback
                const feedbackElement = document.getElementById(`feedback-${category}`);

                if (userSelections[category] === correctAnswers[category]) {
                    feedbackElement.textContent = 'ถูกต้อง!';
                    feedbackElement.className = 'quiz-feedback correct';
                } else {
                    feedbackElement.textContent = `คำตอบที่ถูกต้องคือ ${correctAnswers[category]}`;
                    feedbackElement.className = 'quiz-feedback incorrect';
                }

                feedbackElement.style.display = 'block';
            });
        }

        // Replace or modify the showAnswerSection function
        function showAnswerSection(answers) {
            // Find the full text for each answer code
            const eyeFullText = quizOptions.eye.find(opt => opt.id === answers.eye)?.text || answers.eye;
            const verbalFullText = quizOptions.verbal.find(opt => opt.id === answers.verbal)?.text || answers.verbal;
            const motorFullText = quizOptions.motor.find(opt => opt.id === answers.motor)?.text || answers.motor;
            
            // Set values in the modal
            document.getElementById('modal-answer-eye').textContent = eyeFullText;
            document.getElementById('modal-answer-verbal').textContent = verbalFullText;
            document.getElementById('modal-answer-motor').textContent = motorFullText;
            
            // Update status text and class
            const statusElement = document.getElementById('answer-status');
            const isAllCorrect = (
                userSelections.eye === answers.eye && 
                userSelections.verbal === answers.verbal && 
                userSelections.motor === answers.motor
            );
            
            if (isAllCorrect) {
                statusElement.textContent = 'ถูกต้อง!';
                statusElement.className = 'answer-status correct';
            } else {
                statusElement.textContent = 'ไม่ถูกต้อง';
                statusElement.className = 'answer-status incorrect';
            }
            
            // Show the modal and overlay
            document.getElementById('modal-overlay').style.display = 'block';
            document.getElementById('answer-modal').style.display = 'block';
        }

// Replace or modify the hideAnswerSection function
function hideAnswerSection() {
    document.getElementById('modal-overlay').style.display = 'none';
    document.getElementById('answer-modal').style.display = 'none';
}

// Modify the handleNextClick function to use a longer timeout
function handleNextClick() {
    // Move to the next scenario
    currentScenarioIndex++;
    
    // If all scenarios are completed, show results
    if (currentScenarioIndex >= selectedScenarios.length) {
      showResults();
    } else {
      // Load the next scenario
      loadScenario(selectedScenarios[currentScenarioIndex]);
      
      // Reset button to "ตอบ" (Answer)
      const nextButton = document.getElementById('next-button');
      nextButton.textContent = 'ตอบ';
      nextButton.innerHTML = 'ตอบ <i class="fas fa-check"></i>';
      
      // Change event listener back
      nextButton.removeEventListener('click', handleNextClick);
      nextButton.addEventListener('click', handleAnswerClick);
      
      // Disable the button until all questions are answered
      nextButton.disabled = true;
    }
  }

// Modified function to show results
// ปรับปรุงฟังก์ชัน showResults
function showResults() {
    // ซ่อนส่วนแบบทดสอบและปุ่มถัดไป
    document.getElementById('quiz-sections-container').style.display = 'none';
    document.getElementById('next-button').style.display = 'none';
  
    
    // แสดงผลลัพธ์
    const resultContainer = document.getElementById('result-container');
    resultContainer.style.display = 'flex';
    resultContainer.style.flexDirection = 'column';
    resultContainer.style.alignItems = 'center';
    resultContainer.style.justifyContent = 'center';
    resultContainer.style.maxWidth = '600px';
    resultContainer.style.margin = '0 auto';
    resultContainer.style.padding = '30px';
    resultContainer.style.borderRadius = '15px';
    resultContainer.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.15)';
    resultContainer.style.background = 'linear-gradient(135deg, #ffffff, #f5f5f5)';
    
    // แสดงคะแนนสุดท้าย
    const finalScore = document.getElementById('final-score');
    finalScore.textContent = score;
    
    // สร้างอิลิเมนต์คะแนนรวมที่มีขนาดใหญ่และมีสไตล์
    const scoreDisplay = document.querySelector('.result-score');
    scoreDisplay.style.fontSize = '3rem';
    scoreDisplay.style.fontWeight = 'bold';
    scoreDisplay.style.marginBottom = '20px';
    scoreDisplay.style.color = '#2d3748';
    scoreDisplay.style.textShadow = '2px 2px 4px rgba(0,0,0,0.1)';
    
    // สร้างรูปแบบการแสดงผลที่เหมาะสมตามคะแนน
    const resultMessage = document.getElementById('result-message');
    const resultTitle = document.querySelector('.result-title');
    resultTitle.style.fontSize = '2rem';
    resultTitle.style.marginBottom = '25px';
    resultTitle.style.fontWeight = 'bold';
    resultTitle.style.color = '#2d3748';
    resultTitle.style.textAlign = 'center';
    
    // ปรับแต่งปุ่มให้ดูสวยงามขึ้น
    const buttons = document.querySelectorAll('.result-button');
    buttons.forEach(button => {
        button.style.margin = '10px';
        button.style.padding = '12px 24px';
        button.style.borderRadius = '8px';
        button.style.fontWeight = 'bold';
        button.style.transition = 'all 0.3s ease';
        button.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        button.style.cursor = 'pointer';
    });
    
    // ปรับแต่งข้อความและสีตามระดับคะแนน
    if (score <= 2) {
        // ข้อความสำหรับคะแนนต่ำ
        resultMessage.textContent = 'ไม่เป็นไร คุณสามารถทบทวนและทำใหม่ได้ ความเข้าใจจะพัฒนาขึ้นเรื่อยๆ';
        resultMessage.style.color = '#e53e3e';
        scoreDisplay.style.color = '#e53e3e';
        // ปรับสีปุ่มทำใหม่
        buttons[0].style.backgroundColor = '#e53e3e';
        buttons[0].style.color = 'white';
        buttons[0].style.border = 'none';
    } else if (score == 3) {
        // ข้อความสำหรับคะแนนปานกลาง
        resultMessage.textContent = 'ดีมาก คุณเข้าใจหลักการประเมิน GCS ได้ในระดับที่ดี';
        resultMessage.style.color = '#ecc94b';
        scoreDisplay.style.color = '#ecc94b';
        // ปรับสีปุ่มทำใหม่
        buttons[0].style.backgroundColor = '#ecc94b';
        buttons[0].style.color = 'white';
        buttons[0].style.border = 'none';
    } else {
        // ข้อความสำหรับคะแนนสูง
        resultMessage.textContent = 'ยอดเยี่ยมมาก! คุณมีความเข้าใจในการประเมิน GCS อย่างดีเยี่ยม';
        resultMessage.style.color = '#38a169';
        scoreDisplay.style.color = '#38a169';
        // ปรับสีปุ่มทำใหม่
        buttons[0].style.backgroundColor = '#38a169';
        buttons[0].style.color = 'white';
        buttons[0].style.border = 'none';
    }
    
    // ปรับแต่งปุ่มกลับหน้าหลัก
    buttons[1].style.backgroundColor = '#4299e1';
    buttons[1].style.color = 'white';
    buttons[1].style.border = 'none';
    
    // เพิ่ม hover effect ให้กับปุ่ม
    buttons.forEach(button => {
        button.onmouseover = function() {
            this.style.transform = 'translateY(-3px)';
            this.style.boxShadow = '0 7px 14px rgba(0, 0, 0, 0.15)';
        };
        button.onmouseout = function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '0 4px 6px rgba(0, 0, 0, 0.1)';
        };
    });
    
    // สร้างเอฟเฟกต์พิเศษสำหรับแสดงคะแนน
    const scoreElement = document.querySelector('.result-score');
    scoreElement.style.opacity = '0';
    scoreElement.style.transform = 'scale(0.5)';
    
    // แสดงคะแนนด้วยเอฟเฟกต์
    setTimeout(() => {
        scoreElement.style.transition = 'all 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        scoreElement.style.opacity = '1';
        scoreElement.style.transform = 'scale(1)';
    }, 300);
    
    // แสดงข้อความด้วยเอฟเฟกต์เลื่อนขึ้น
    resultMessage.style.opacity = '0';
    resultMessage.style.transform = 'translateY(20px)';
    
    setTimeout(() => {
        resultMessage.style.transition = 'all 0.8s ease';
        resultMessage.style.opacity = '1';
        resultMessage.style.transform = 'translateY(0)';
    }, 600);
    
    // แสดงปุ่มด้วยเอฟเฟกต์เลื่อนขึ้น
    buttons.forEach((button, index) => {
        button.style.opacity = '0';
        button.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            button.style.transition = 'all 0.6s ease';
            button.style.opacity = '1';
            button.style.transform = 'translateY(0)';
        }, 900 + (index * 200));
    });
    
    // แสดงเอฟเฟกต์ดอกไม้ไฟหากคะแนนมากกว่าหรือเท่ากับ 3
    if (score >= 3) {
        createFireworks();
    }
}

// เพิ่มฟังก์ชั่นพื้นฐานฉากหลัง
function addBackgroundEffects() {
    // สร้างฉากหลังกราเดียนต์สำหรับ result-container
    const container = document.querySelector('.content-container');
    const bgEffect = document.createElement('div');
    bgEffect.className = 'result-background-effect';
    bgEffect.style.position = 'absolute';
    bgEffect.style.top = '0';
    bgEffect.style.left = '0';
    bgEffect.style.width = '100%';
    bgEffect.style.height = '100%';
    bgEffect.style.background = 'radial-gradient(circle at center, rgba(66, 153, 225, 0.08) 0%, transparent 70%)';
    bgEffect.style.zIndex = '-1';
    bgEffect.style.opacity = '0';
    bgEffect.style.transition = 'opacity 1s ease';
    
    container.appendChild(bgEffect);
    
    // แสดงฉากหลังพร้อมกับผลลัพธ์
    setTimeout(() => {
        bgEffect.style.opacity = '1';
    }, 200);
}

function createFireworks() {
    addBackgroundEffects();
    
    const fireworksContainer = document.createElement('div');
    fireworksContainer.className = 'fireworks-container';
    fireworksContainer.style.position = 'absolute';
    fireworksContainer.style.top = '0';
    fireworksContainer.style.left = '0';
    fireworksContainer.style.width = '100%';
    fireworksContainer.style.height = '100%';
    fireworksContainer.style.pointerEvents = 'none';
    fireworksContainer.style.zIndex = '1000';
    document.querySelector('.content-container').appendChild(fireworksContainer);
    
    // สร้างดอกไม้ไฟหลายดอก
    for (let i = 0; i < 12; i++) {
        setTimeout(() => {
            launchFirework(fireworksContainer);
        }, i * 400);
    }
    
    // ลบ container หลังจากแอนิเมชั่นเสร็จสิ้น
    setTimeout(() => {
        fireworksContainer.style.transition = 'opacity 1s ease';
        fireworksContainer.style.opacity = '0';
        setTimeout(() => {
            fireworksContainer.remove();
        }, 1000);
    }, 10000);
    
    // เพิ่มเอฟเฟกต์คอนเฟตติเพื่อความน่าสนใจ
    createConfetti();
}

// Enhanced Fireworks and Confetti Functions

// ===== ENHANCED FIREWORKS EFFECT =====
function createFireworks() {
    addBackgroundEffects();
    
    const fireworksContainer = document.createElement('div');
    fireworksContainer.className = 'fireworks-container';
    fireworksContainer.style.position = 'fixed';
    fireworksContainer.style.top = '0';
    fireworksContainer.style.left = '0';
    fireworksContainer.style.width = '100%';
    fireworksContainer.style.height = '100%';
    fireworksContainer.style.pointerEvents = 'none';
    fireworksContainer.style.zIndex = '1000';
    document.body.appendChild(fireworksContainer);
    
    // Create multiple firework sequences with varying timing
    for (let i = 0; i < 20; i++) {
      setTimeout(() => {
        launchFirework(fireworksContainer);
      }, i * 300 + Math.random() * 500);
    }
    
    // Continue fireworks for a longer period
    let continueFireworks = setInterval(() => {
      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          launchFirework(fireworksContainer);
        }, i * 200);
      }
    }, 2000);
    
    // Stop the continuous fireworks after 15 seconds
    setTimeout(() => {
      clearInterval(continueFireworks);
      fireworksContainer.style.transition = 'opacity 1s ease';
      fireworksContainer.style.opacity = '0';
      setTimeout(() => {
        fireworksContainer.remove();
      }, 1000);
    }, 15000);
    
    // Launch confetti alongside fireworks
    createConfetti();
  }
  
  function launchFirework(container) {
    const firework = document.createElement('div');
    firework.className = 'firework';
    
    // Random position with more natural distribution
    const left = Math.random() * 80 + 10;
    firework.style.left = `${left}%`;
    firework.style.bottom = '0';
    firework.style.position = 'absolute';
    firework.style.width = '5px';
    firework.style.height = '5px';
    firework.style.borderRadius = '50%';
    firework.style.backgroundColor = '#FFF';
    firework.style.boxShadow = '0 0 10px 2px rgba(255, 255, 255, 0.8)';
    
    container.appendChild(firework);
    
    // Define animations with keyframes
    const launchKeyframes = `
      @keyframes launch-${left} {
        0% { transform: translateY(0); opacity: 1; }
        70% { opacity: 1; }
        100% { transform: translateY(-${Math.random() * 70 + 30}vh); opacity: 0; }
      }
    `;
    
    // Add keyframes to document
    const styleSheet = document.createElement('style');
    styleSheet.innerHTML = launchKeyframes;
    document.head.appendChild(styleSheet);
    
    // Apply animation
    firework.style.animation = `launch-${left} ${Math.random() * 0.5 + 1}s ease-out forwards`;
    
    // Explode after launch animation
    setTimeout(() => {
      const x = firework.offsetLeft;
      const y = firework.offsetTop;
      
      // Remove the launch element
      firework.remove();
      
      // Create explosion
      createExplosion(container, x, y);
    }, 1000);
  }
  
  function createExplosion(container, x, y) {
    // Choose random explosion type
    const explosionTypes = ['circle', 'sphere', 'burst', 'star'];
    const explosionType = explosionTypes[Math.floor(Math.random() * explosionTypes.length)];
    
    // Random color scheme
    const colorSchemes = [
      ['#FF0000', '#FF7F00', '#FFFF00', '#FF4500'], // Red-Orange
      ['#00FFFF', '#00BFFF', '#1E90FF', '#0000FF'], // Blue scheme
      ['#FF00FF', '#DA70D6', '#9370DB', '#8A2BE2'], // Purple scheme
      ['#FFFF00', '#FFD700', '#FFA500', '#FF8C00'], // Gold scheme
      ['#00FF00', '#7FFF00', '#00FA9A', '#32CD32']  // Green scheme
    ];
    
    const colors = colorSchemes[Math.floor(Math.random() * colorSchemes.length)];
    
    // Number of particles
    const particleCount = Math.floor(Math.random() * 30) + 50;
    
    // Create explosion container
    const explosion = document.createElement('div');
    explosion.className = 'explosion';
    explosion.style.position = 'absolute';
    explosion.style.left = `${x}px`;
    explosion.style.top = `${y}px`;
    explosion.style.width = '6px';
    explosion.style.height = '6px';
    explosion.style.zIndex = '1001';
    container.appendChild(explosion);
    
    // Add initial flash
    const flash = document.createElement('div');
    flash.className = 'flash';
    flash.style.position = 'absolute';
    flash.style.left = '-50px';
    flash.style.top = '-50px';
    flash.style.width = '100px';
    flash.style.height = '100px';
    flash.style.borderRadius = '50%';
    flash.style.backgroundColor = colors[0];
    flash.style.boxShadow = `0 0 80px 20px ${colors[0]}`;
    flash.style.opacity = '0';
    flash.style.animation = 'flash 0.5s ease-out forwards';
    explosion.appendChild(flash);
    
    // Define flash animation
    const flashKeyframes = `
      @keyframes flash {
        0% { transform: scale(0.1); opacity: 1; }
        50% { opacity: 1; }
        100% { transform: scale(1.5); opacity: 0; }
      }
    `;
    
    // Add flash keyframes
    const flashStyle = document.createElement('style');
    flashStyle.innerHTML = flashKeyframes;
    document.head.appendChild(flashStyle);
    
    // Create particles based on explosion type
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      
      // Base particle styling
      particle.style.position = 'absolute';
      particle.style.left = '0';
      particle.style.top = '0';
      particle.style.width = `${Math.random() * 4 + 2}px`;
      particle.style.height = particle.style.width;
      particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      particle.style.borderRadius = '50%';
      particle.style.boxShadow = `0 0 6px 2px ${particle.style.backgroundColor}`;
      
      // Calculate trajectory based on explosion type
      let angle, distance, duration, delay;
      
      switch (explosionType) {
        case 'circle':
          angle = (i / particleCount) * Math.PI * 2;
          distance = Math.random() * 30 + 70;
          break;
        case 'sphere':
          angle = Math.random() * Math.PI * 2;
          distance = Math.random() * 80 + 20;
          break;
        case 'burst':
          angle = Math.random() * Math.PI * 2;
          distance = Math.random() * 50 + (i % 2 === 0 ? 70 : 40);
          break;
        case 'star':
          const arms = 5;
          const arm = i % arms;
          const armAngle = (arm / arms) * Math.PI * 2;
          const inArm = Math.random() > 0.5;
          angle = armAngle + (inArm ? Math.random() * 0.3 : Math.random() * Math.PI * 2);
          distance = inArm ? Math.random() * 30 + 90 : Math.random() * 40 + 30;
          break;
      }
      
      // Randomize duration and trail effect
      duration = Math.random() * 1.5 + 1;
      delay = Math.random() * 0.2;
      
      // Create unique animation for each particle
      const particleId = `particle-${Date.now()}-${i}`;
      const particleKeyframes = `
        @keyframes ${particleId} {
          0% { 
            transform: translate(0, 0) scale(1); 
            opacity: 1;
          }
          40% {
            opacity: 0.8;
          }
          70% {
            opacity: 0.6;
          }
          100% { 
            transform: translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0.1);
            opacity: 0;
          }
        }
      `;
      
      // Add particle keyframes
      const particleStyle = document.createElement('style');
      particleStyle.innerHTML = particleKeyframes;
      document.head.appendChild(particleStyle);
      
      // Apply animation with delay
      particle.style.animation = `${particleId} ${duration}s ease-out ${delay}s forwards`;
      
      // Add to explosion
      explosion.appendChild(particle);
      
      // Create trailing particles for more complex effects
      if (Math.random() > 0.7) {
        createTrailingParticle(explosion, particle, particleId, colors, duration, delay);
      }
    }
    
    // Remove explosion container after animations complete
    setTimeout(() => {
      explosion.remove();
    }, 3000);
    
    // Add boom sound effect
    playExplosionSound();
  }
  
  function createTrailingParticle(explosion, parentParticle, parentId, colors, parentDuration, parentDelay) {
    const trail = document.createElement('div');
    trail.className = 'trail';
    
    // Smaller size for trail particles
    trail.style.position = 'absolute';
    trail.style.left = '0';
    trail.style.top = '0';
    trail.style.width = `${parseInt(parentParticle.style.width) * 0.6}px`;
    trail.style.height = trail.style.width;
    trail.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    trail.style.borderRadius = '50%';
    trail.style.boxShadow = `0 0 4px 1px ${trail.style.backgroundColor}`;
    
    // Create unique trail animation
    const trailId = `trail-${parentId}`;
    const trailKeyframes = `
      @keyframes ${trailId} {
        0% { 
          transform: translate(0, 0) scale(0.8); 
          opacity: 0;
        }
        20% {
          opacity: 0.7;
        }
        100% { 
          transform: translate(${Math.random() * 40 - 20}px, ${Math.random() * 40 - 20}px) scale(0.2);
          opacity: 0;
        }
      }
    `;
    
    // Add trail keyframes
    const trailStyle = document.createElement('style');
    trailStyle.innerHTML = trailKeyframes;
    document.head.appendChild(trailStyle);
    
    // Apply animation with delay
    const trailDuration = parentDuration * 0.7;
    const trailDelay = parentDelay + (parentDuration * 0.3);
    trail.style.animation = `${trailId} ${trailDuration}s ease-out ${trailDelay}s forwards`;
    
    // Add to explosion
    explosion.appendChild(trail);
  }
  
  // Play explosion sound effect (with low volume)
  function playExplosionSound() {
    if (Math.random() > 0.3) { // Only play for some explosions to avoid sound overload
      const soundType = Math.floor(Math.random() * 3);
      const sound = new Audio();
      
      switch (soundType) {
        case 0:
          sound.src = 'data:audio/mp3;base64,SUQzAwAAAAAAInRJVDIAAAABAAAARW5oYW5jZWQgYXVkaW8gZm9yIGZpcmV3b3JrcwA='; // Base64 encoded small sound
          break;
        case 1:
          sound.src = 'data:audio/mp3;base64,SUQzAwAAAAAAInRJVDIAAAABAAAARW5oYW5jZWQgYXVkaW8gZm9yIGZpcmV3b3JrcwA='; // Base64 encoded small sound
          break;
        case 2:
          sound.src = 'data:audio/mp3;base64,SUQzAwAAAAAAInRJVDIAAAABAAAARW5oYW5jZWQgYXVkaW8gZm9yIGZpcmV3b3JrcwA='; // Base64 encoded small sound
          break;
      }
      
      sound.volume = 0.1; // Very low volume
      sound.play().catch(err => console.log('Audio play failed:', err));
    }
  }
  
  // ===== ENHANCED CONFETTI EFFECT =====
  function createConfetti() {
    const confettiContainer = document.createElement('div');
    confettiContainer.className = 'confetti-container';
    confettiContainer.style.position = 'fixed';
    confettiContainer.style.top = '0';
    confettiContainer.style.left = '0';
    confettiContainer.style.width = '100%';
    confettiContainer.style.height = '0';
    confettiContainer.style.overflow = 'visible';
    confettiContainer.style.pointerEvents = 'none';
    confettiContainer.style.zIndex = '999';
    document.body.appendChild(confettiContainer);
    
    // Add confetti style if not already present
    if (!document.querySelector('style#confetti-style')) {
      const styleElement = document.createElement('style');
      styleElement.id = 'confetti-style';
      styleElement.innerHTML = `
        @keyframes confettiFall {
          0% {
            transform: translateY(0) rotate(0);
            opacity: 1;
          }
          100% {
            transform: translateY(100vh) rotate(720deg);
            opacity: 0;
          }
        }
        
        @keyframes confettiSway {
          0% {
            transform: translateX(0);
          }
          25% {
            transform: translateX(15px);
          }
          50% {
            transform: translateX(-15px);
          }
          75% {
            transform: translateX(15px);
          }
          100% {
            transform: translateX(0);
          }
        }
      `;
      document.head.appendChild(styleElement);
    }
    
    // Vibrant colors for confetti
    const colors = [
      '#FF3855', '#FD3A4A', '#FB4D46', '#FA5B3D', '#FFAA1D', 
      '#FFF700', '#299617', '#A7F432', '#2243B6', '#5DADEC',
      '#5946B2', '#9C51B6', '#A83731', '#AF6E4D', '#FF5470',
      '#FF7A00', '#FFAA00', '#FFBD00', '#FFD300', '#FFEA00',
      '#E936A7'
    ];
    
    // Create initial large confetti burst
    for (let i = 0; i < 200; i++) {
      createConfettiPiece(confettiContainer, colors, true);
    }
    
    // Add some delayed bursts for continuous effect
    setTimeout(() => {
      for (let i = 0; i < 50; i++) {
        createConfettiPiece(confettiContainer, colors, false);
      }
    }, 1500);
    
    setTimeout(() => {
      for (let i = 0; i < 50; i++) {
        createConfettiPiece(confettiContainer, colors, false);
      }
    }, 3000);
    
    // Remove container after animations
    setTimeout(() => {
      confettiContainer.style.transition = 'opacity 1s ease';
      confettiContainer.style.opacity = '0';
      setTimeout(() => {
        confettiContainer.remove();
      }, 1000);
    }, 10000);
  }
  
  function createConfettiPiece(container, colors, initialBurst) {
    const confetti = document.createElement('div');
    confetti.style.position = 'absolute';
    
    // Random size and shape
    const isSquare = Math.random() > 0.5;
    const size = Math.random() * 10 + 5;
    confetti.style.width = `${size}px`;
    confetti.style.height = isSquare ? `${Math.random() * 5 + 5}px` : `${size}px`;
    
    // Random color and opacity
    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
    confetti.style.opacity = Math.random() * 0.8 + 0.2;
    
    // Random position
    confetti.style.left = `${Math.random() * 100}vw`;
    confetti.style.top = initialBurst ? `-20px` : `${Math.random() * 50 - 60}px`;
    
    // Random shape
    const shapeType = Math.floor(Math.random() * 4);
    switch (shapeType) {
      case 0: // Circle
        confetti.style.borderRadius = '50%';
        break;
      case 1: // Square
        confetti.style.borderRadius = '0';
        break;
      case 2: // Star-like
        confetti.style.clipPath = 'polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)';
        break;
      case 3: // Heart-like
        confetti.style.clipPath = 'polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%)';
        confetti.style.transform = 'rotate(45deg)';
        break;
    }
    
    // Apply animations with randomized parameters
    const fallDuration = Math.random() * 5 + 3;
    const swayDuration = Math.random() * 3 + 2;
    const fallDelay = initialBurst ? Math.random() * 2 : 0;
    
    confetti.style.animation = `
      confettiFall ${fallDuration}s ease-in ${fallDelay}s forwards,
      confettiSway ${swayDuration}s ease-in-out ${fallDelay}s infinite alternate
    `;
    
    // Add glitter effect for some confetti
    if (Math.random() > 0.7) {
      confetti.style.boxShadow = `0 0 ${Math.random() * 5 + 2}px ${confetti.style.backgroundColor}`;
    }
    
    // Attach to container
    container.appendChild(confetti);
    
    // Remove after animation
    setTimeout(() => {
      confetti.remove();
    }, (fallDuration + fallDelay) * 1000);
  }
  
  // ===== BACKGROUND EFFECTS =====
  function addBackgroundEffects() {
    // Create gradient background effect
    const container = document.querySelector('.content-container') || document.body;
    
    // Create and add the background effect div
    const bgEffect = document.createElement('div');
    bgEffect.className = 'result-background-effect';
    bgEffect.style.position = 'fixed';
    bgEffect.style.top = '0';
    bgEffect.style.left = '0';
    bgEffect.style.width = '100%';
    bgEffect.style.height = '100%';
    bgEffect.style.background = 'radial-gradient(circle at center, rgba(66, 153, 225, 0.15) 0%, rgba(56, 161, 105, 0.1) 35%, rgba(236, 201, 75, 0.05) 70%, transparent 100%)';
    bgEffect.style.zIndex = '-1';
    bgEffect.style.opacity = '0';
    bgEffect.style.transition = 'opacity 1s ease';
    
    container.appendChild(bgEffect);
    
    // Create subtle animated light beams
    const beamContainer = document.createElement('div');
    beamContainer.className = 'beam-container';
    beamContainer.style.position = 'fixed';
    beamContainer.style.top = '0';
    beamContainer.style.left = '0';
    beamContainer.style.width = '100%';
    beamContainer.style.height = '100%';
    beamContainer.style.zIndex = '-1';
    beamContainer.style.opacity = '0';
    beamContainer.style.transition = 'opacity 1.5s ease';
    
    // Create light beams
    for (let i = 0; i < 5; i++) {
      const beam = document.createElement('div');
      beam.className = 'light-beam';
      beam.style.position = 'absolute';
      beam.style.width = `${Math.random() * 100 + 200}px`;
      beam.style.height = '100vh';
      beam.style.left = `${Math.random() * 100}%`;
      beam.style.background = 'linear-gradient(to bottom, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0.05) 100%)';
      beam.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
      beam.style.transformOrigin = 'top';
      beam.style.animation = `beam-move ${Math.random() * 10 + 15}s linear infinite`;
      
      beamContainer.appendChild(beam);
    }
    
    // Add beam movement animation
    const beamStyle = document.createElement('style');
    beamStyle.innerHTML = `
      @keyframes beam-move {
        0% { transform: rotate(${Math.random() * 10 - 5}deg) translateX(-30vw); opacity: 0.2; }
        50% { opacity: 0.7; }
        100% { transform: rotate(${Math.random() * 10 - 5}deg) translateX(130vw); opacity: 0.2; }
      }
    `;
    document.head.appendChild(beamStyle);
    
    container.appendChild(beamContainer);
    
    // Create subtle light particles floating upward
    const particlesContainer = document.createElement('div');
    particlesContainer.className = 'particles-container';
    particlesContainer.style.position = 'fixed';
    particlesContainer.style.bottom = '0';
    particlesContainer.style.left = '0';
    particlesContainer.style.width = '100%';
    particlesContainer.style.height = '100%';
    particlesContainer.style.zIndex = '-1';
    particlesContainer.style.opacity = '0';
    particlesContainer.style.transition = 'opacity 2s ease';
    
    // Create floating particles
    for (let i = 0; i < 30; i++) {
      const particle = document.createElement('div');
      particle.className = 'floating-particle';
      particle.style.position = 'absolute';
      particle.style.width = `${Math.random() * 8 + 2}px`;
      particle.style.height = particle.style.width;
      particle.style.borderRadius = '50%';
      particle.style.backgroundColor = `rgba(255, 255, 255, ${Math.random() * 0.15 + 0.05})`;
      particle.style.bottom = '-20px';
      particle.style.left = `${Math.random() * 100}%`;
      particle.style.animation = `float-up ${Math.random() * 15 + 10}s linear infinite`;
      particle.style.animationDelay = `${Math.random() * 10}s`;
      
      particlesContainer.appendChild(particle);
    }
    
    // Add floating animation
    const particleStyle = document.createElement('style');
    particleStyle.innerHTML = `
      @keyframes float-up {
        0% { transform: translateY(0) translateX(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 0.7; }
        100% { transform: translateY(-100vh) translateX(${Math.random() * 100 - 50}px); opacity: 0; }
      }
    `;
    document.head.appendChild(particleStyle);
    
    container.appendChild(particlesContainer);
    
    // Gradually show all background effects
    setTimeout(() => {
      bgEffect.style.opacity = '1';
    }, 300);
    
    setTimeout(() => {
      beamContainer.style.opacity = '1';
    }, 800);
    
    setTimeout(() => {
      particlesContainer.style.opacity = '1';
    }, 1500);
  }

        // Function to restart the test
        function restartTest() {
            // Reset variables
            currentScenarioIndex = 0;
            score = 0;

            // Select new random scenarios
            selectedScenarios = selectRandomScenarios();

            // Hide results
            document.getElementById('result-container').style.display = 'none';

            // Show quiz content
            document.getElementById('quiz-sections-container').style.display = 'block';
            document.getElementById('next-button').style.display = 'block';
            document.getElementById('media-container').style.display = 'flex';

            // Load the first scenario
            loadScenario(selectedScenarios[currentScenarioIndex]);
        }
        // เพิ่มเอฟเฟกต์ลอยสำหรับปุ่มโฮม
        const homeButton = document.querySelector('.home-button,.back-button');
        homeButton.style.animation = 'float 3s ease-in-out infinite';
        
        // Function to go to home page
        function goToHome() {
            console.log("Going to home page");
            // Add home navigation here
            window.location.href = "/index.html";

            // Visual feedback for button click
            const homeButton = document.querySelector('.home-button');
            homeButton.style.transform = 'scale(0.9)';

            setTimeout(() => {
                homeButton.style.transform = 'scale(1.1)';
            }, 150);
        }

        // Function to go back to test selection page
        function goBack() {
            console.log("Going Back");
            // Add home navigation here
            window.location.href = "/test.html";

            // Visual feedback for button click
            const homeButton = document.querySelector('.back-button');
            homeButton.style.transform = 'scale(0.9)';

            setTimeout(() => {
                homeButton.style.transform = 'scale(1.1)';
            }, 150);
        }

        // Function to set header video based on level
        function setHeaderVideo() {
            const videoSource = document.getElementById('header-video-source');
            videoSource.src = `assest/video_bg/level${currentLevel}.mp4`;

            const headerVideo = document.querySelector('.header-video');
            headerVideo.load();
            headerVideo.play().catch(error => {
                console.log("Auto-play was prevented:", error);
            });
        }
        function handleAnswerClick() {
            // Lock all selections
            answeredQuestions = {
                eye: true,
                verbal: true,
                motor: true
            };
            
            // Make all non-selected options inactive
            ['eye', 'verbal', 'motor'].forEach(category => {
                const options = document.querySelectorAll(`.quiz-option[data-category="${category}"]`);
                options.forEach(option => {
                    if (option.dataset.value !== userSelections[category]) {
                        option.classList.add('inactive');
                    }
                });
            });
            
            // Check answers and update score
            const isCorrect = checkAnswers();
            if (isCorrect) {
                score++;
                document.getElementById('current-score').textContent = score;
            }
            
            // Change button text to "ถัดไป" (Next)
            const nextButton = document.getElementById('next-button');
            nextButton.textContent = 'ถัดไป';
            nextButton.innerHTML = 'ถัดไป <i class="fas fa-arrow-right"></i>';
            
            // Change event listener for the button
            nextButton.removeEventListener('click', handleAnswerClick);
            nextButton.addEventListener('click', handleNextClick);
            
            // Enable the button
            nextButton.disabled = false;
        }
        function setHeaderContent() {
            // Set header video
            const videoSource = document.getElementById('header-video-source');
            videoSource.src = `assest/video_bg/level${currentLevel}.mp4`;
        
            const headerVideo = document.querySelector('.header-video');
            headerVideo.load();
            headerVideo.play().catch(error => {
                console.log("Auto-play was prevented:", error);
            });
            
        
        }

        // Function to initialize the page
        function initPage() {
            const params = getUrlParams();
            currentLevel = params.level;
        
            // Set header content based on level
            setHeaderContent();
        
            // Select random scenarios
            selectedScenarios = selectRandomScenarios();
        
            // Load the first scenario
            if (selectedScenarios.length > 0) {
                loadScenario(selectedScenarios[currentScenarioIndex]);
            }
        
            // Change the button text to "ตอบ" (Answer)
            document.getElementById('next-button').textContent = 'ตอบ';
            document.getElementById('next-button').innerHTML = 'ตอบ <i class="fas fa-check"></i>';
            
            // Change event listener for the button
            document.getElementById('next-button').addEventListener('click', handleAnswerClick);
            
            // Add event listener for the modal overlay to close when clicked
        
            
            // Set header text
            
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function () {
            initPage();
        });
    </script>
</body>

</html>